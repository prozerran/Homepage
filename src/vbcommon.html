<pre style='color:#000020;background:#f6f8ff;'><span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span>
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>IO
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Collections<span style='color:#008c00; '>.</span>Generic
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Linq
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span>
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Web
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>ServiceModel
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>ServiceModel<span style='color:#008c00; '>.</span>Channels
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>DirectoryServices
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Configuration
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Web<span style='color:#008c00; '>.</span>Configuration
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Data<span style='color:#008c00; '>.</span>SqlClient
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Data
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Net

<span style='color:#200080; font-weight:bold; '>Imports</span> SVSCrypto

<span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Class</span> DAL
    <span style='color:#200080; font-weight:bold; '>Inherits</span> SingletonBaseT<span style='color:#308080; '>(</span>Of DAL<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>Implements</span> IDAL

    <span style='color:#200080; font-weight:bold; '>Private</span> SqlConnStr_SignSec_DB <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> SqlConnStr_SignDB <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> CommandTimeout <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> SessionTimeout <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> DebugMode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> TraceMode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> StressTestMode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>

    <span style='color:#595979; '>'Public Sub New(ByVal SignDB_ConnectStr As String, ByVal SignSec_ConnectStr As String, ByVal cmdTimeOut As String)</span>
    <span style='color:#595979; '>'    InitConnectionsStr(SignDB_ConnectStr, SignSec_ConnectStr, cmdTimeOut)</span>
    <span style='color:#595979; '>'End Sub</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Sub</span> InitConnectionsStr<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> SignDB_ConnectStr <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> SignSec_ConnectStr <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> cmdTimeOut <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> keyFileLocation <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>
        DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"SVSDBConnStr_key_location"</span><span style='color:#308080; '>,</span> keyFileLocation<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> cm <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> CryptoModule
        <span style='color:#200080; font-weight:bold; '>Dim</span> keyFile <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> StreamReader<span style='color:#308080; '>(</span>keyFileLocation<span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"Decrypting Connection String"</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> cm<span style='color:#008c00; '>.</span>UnMassageKeyString<span style='color:#308080; '>(</span>keyFile<span style='color:#008c00; '>.</span>ReadLine<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>SqlConnStr_SignSec_DB <span style='color:#308080; '>=</span> cm<span style='color:#008c00; '>.</span>DecryptTripleDES<span style='color:#308080; '>(</span>key<span style='color:#308080; '>,</span> SignSec_ConnectStr<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>SqlConnStr_SignDB <span style='color:#308080; '>=</span> cm<span style='color:#008c00; '>.</span>DecryptTripleDES<span style='color:#308080; '>(</span>key<span style='color:#308080; '>,</span> SignDB_ConnectStr<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>

        <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>CommandTimeout <span style='color:#308080; '>=</span> cmdTimeOut

        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> sTmOut <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"20"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"session_timeout_min"</span><span style='color:#308080; '>,</span> sTmOut<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>SessionTimeout <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Integer</span><span style='color:#008c00; '>.</span>Parse<span style='color:#308080; '>(</span>sTmOut<span style='color:#308080; '>)</span>

            <span style='color:#200080; font-weight:bold; '>Dim</span> debug_mode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"False"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"debug"</span><span style='color:#308080; '>,</span> debug_mode<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>DebugMode <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Boolean</span><span style='color:#008c00; '>.</span>Parse<span style='color:#308080; '>(</span>debug_mode<span style='color:#308080; '>)</span>

            <span style='color:#200080; font-weight:bold; '>Dim</span> trace_mode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"False"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"trace"</span><span style='color:#308080; '>,</span> trace_mode<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>TraceMode <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Boolean</span><span style='color:#008c00; '>.</span>Parse<span style='color:#308080; '>(</span>trace_mode<span style='color:#308080; '>)</span>

            <span style='color:#200080; font-weight:bold; '>Dim</span> stresstest_mode <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"False"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"stresstest"</span><span style='color:#308080; '>,</span> stresstest_mode<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>StressTestMode <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Boolean</span><span style='color:#008c00; '>.</span>Parse<span style='color:#308080; '>(</span>stresstest_mode<span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Sub</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetAppSetting<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> value <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            value <span style='color:#308080; '>=</span> WebConfigurationManager<span style='color:#008c00; '>.</span>AppSettings<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>ToString
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> IsDebugMode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>DebugMode
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> IsTraceMode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>TraceMode
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> IsStressTestMode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>StressTestMode
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetDomainId<span style='color:#308080; '>(</span>id <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> id<span style='color:#008c00; '>.</span>Split<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>Char</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> {<span style='color:#1060b6; '>"\"</span>c}<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>First<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Return</span> id
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetUserId<span style='color:#308080; '>(</span>id <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> id<span style='color:#008c00; '>.</span>Split<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>Char</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> {<span style='color:#1060b6; '>"\"</span>c}<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>Last<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Return</span> id
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> FromUnixTime<span style='color:#308080; '>(</span>unixTime <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Long</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DateTime
        <span style='color:#200080; font-weight:bold; '>Dim</span> epoch <span style='color:#200080; font-weight:bold; '>As</span> DateTime <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DateTime<span style='color:#308080; '>(</span><span style='color:#008c00; '>1970</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> DateTimeKind<span style='color:#008c00; '>.</span>Utc<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> epoch<span style='color:#008c00; '>.</span>AddSeconds<span style='color:#308080; '>(</span>unixTime<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> ToUnixTime<span style='color:#308080; '>(</span>dtTime <span style='color:#200080; font-weight:bold; '>As</span> DateTime<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Long</span>
        <span style='color:#200080; font-weight:bold; '>If</span> dtTime<span style='color:#008c00; '>.</span>Ticks <span style='color:#308080; '>=</span> <span style='color:#008c00; '>599266080000000000</span> <span style='color:#200080; font-weight:bold; '>Or</span> dtTime <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"#1/1/1900#"</span> <span style='color:#200080; font-weight:bold; '>Then</span>   <span style='color:#595979; '>' 1900-01-01</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#008c00; '>0</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> epoch <span style='color:#200080; font-weight:bold; '>As</span> DateTime <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DateTime<span style='color:#308080; '>(</span><span style='color:#008c00; '>1970</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> DateTimeKind<span style='color:#008c00; '>.</span>Utc<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#308080; '>(</span>dtTime <span style='color:#308080; '>-</span> epoch<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>TotalSeconds
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> AuthenticatedLDAP<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> username <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> pwd <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> _path <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> ConfigurationManager<span style='color:#008c00; '>.</span>ConnectionStrings<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"LDAP_Authen_ConnectStr"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>ConnectionString
            Using entry <span style='color:#200080; font-weight:bold; '>As</span> DirectoryEntry <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DirectoryEntry<span style='color:#308080; '>(</span>_path<span style='color:#308080; '>,</span> username<span style='color:#308080; '>,</span> pwd<span style='color:#308080; '>)</span>
                entry<span style='color:#008c00; '>.</span>RefreshCache<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using

            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetRandom<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> Min <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> Max <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> Generator <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Random <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Random<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> Generator<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Next</span><span style='color:#308080; '>(</span>Min<span style='color:#308080; '>,</span> Max<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSearchInfoByType<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> param1 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> param2 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> param3 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>If</span> type <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"acct"</span> <span style='color:#200080; font-weight:bold; '>Then</span>
            type <span style='color:#308080; '>=</span> param1
            param1 <span style='color:#308080; '>=</span> param2
            param2 <span style='color:#308080; '>=</span> param3
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

        <span style='color:#200080; font-weight:bold; '>Dim</span> max_tot <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"1000"</span>
        DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"max_search_result"</span><span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} {1}, {2}, {3}, {4}, {5}"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetSearchInfoByType<span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> param1<span style='color:#308080; '>,</span> param2<span style='color:#308080; '>,</span> param3<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSearchInfoByType: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>

        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> ExecuteSQLReader<span style='color:#308080; '>(</span>sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"ExecuteSQLReader: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>

        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetDataInfoByType<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> res <span style='color:#200080; font-weight:bold; '>As</span> AccountDataResponse<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>

                <span style='color:#200080; font-weight:bold; '>If</span> IsNothing<span style='color:#308080; '>(</span>res<span style='color:#008c00; '>.</span>data<span style='color:#008c00; '>.</span>acctNo<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', NULL"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetDataInfoByType<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Else</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', '{3}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetDataInfoByType<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> res<span style='color:#008c00; '>.</span>data<span style='color:#008c00; '>.</span>acctNo<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetDataInfoByType: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSignatureByType<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> res <span style='color:#200080; font-weight:bold; '>As</span> AccountDataResponse<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>

                <span style='color:#200080; font-weight:bold; '>If</span> IsNothing<span style='color:#308080; '>(</span>res<span style='color:#008c00; '>.</span>data<span style='color:#008c00; '>.</span>acctNo<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', NULL"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetSignatureByType<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Else</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', '{3}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetSignatureByType<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> res<span style='color:#008c00; '>.</span>data<span style='color:#008c00; '>.</span>acctNo<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSignatureByType: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSignatureHistory<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByRef</span> type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> param1 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> param2 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#200080; font-weight:bold; '>Implements</span> IDAL<span style='color:#008c00; '>.</span>GetSignatureHistory
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>

            <span style='color:#200080; font-weight:bold; '>Dim</span> max_tot <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"20"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"max_history_result"</span><span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>)</span>

            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} {1}, '{2}', '{3}', '{4}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetSignHist<span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> param1<span style='color:#308080; '>,</span> param2<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSignatureHistory: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetImageHistory<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByRef</span> type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> param1 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> param2 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>

            <span style='color:#200080; font-weight:bold; '>Dim</span> max_tot <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"20"</span>
            DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>GetAppSetting<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"max_history_result"</span><span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>)</span>

            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} {1}, '{2}', '{3}', '{4}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetImageHist<span style='color:#308080; '>,</span> max_tot<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> param1<span style='color:#308080; '>,</span> param2<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetImageHistory: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetCustomerImage<span style='color:#308080; '>(</span>docType <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> docId <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> signId <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Implements</span> IDAL<span style='color:#008c00; '>.</span>GetCustomerImage
        <span style='color:#200080; font-weight:bold; '>Dim</span> s <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Nothing</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetCustomerImage: "</span> <span style='color:#308080; '>+</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"{0}-{1}-{2}"</span><span style='color:#308080; '>,</span> docType<span style='color:#308080; '>,</span> docId<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                s <span style='color:#308080; '>=</span> DirectCast<span style='color:#308080; '>(</span>conn<span style='color:#008c00; '>.</span>Execute<span style='color:#308080; '>(</span>SPNames<span style='color:#008c00; '>.</span>SP_GetCustImage<span style='color:#308080; '>,</span> CommandType<span style='color:#008c00; '>.</span>StoredProcedure<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             DBoxSqlConnection<span style='color:#008c00; '>.</span>ExecuteType<span style='color:#008c00; '>.</span>ExecuteScalar<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             docType<span style='color:#308080; '>,</span> docId<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> s
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSignatureImage<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> signId <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> s <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Nothing</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSignatureImage: "</span> <span style='color:#308080; '>+</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"{0}-{1}-{2}"</span><span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                s <span style='color:#308080; '>=</span> DirectCast<span style='color:#308080; '>(</span>conn<span style='color:#008c00; '>.</span>Execute<span style='color:#308080; '>(</span>SPNames<span style='color:#008c00; '>.</span>SP_GetSignImage<span style='color:#308080; '>,</span> CommandType<span style='color:#008c00; '>.</span>StoredProcedure<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             DBoxSqlConnection<span style='color:#008c00; '>.</span>ExecuteType<span style='color:#008c00; '>.</span>ExecuteScalar<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> s
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSignatureImageHist<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> signId <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> histdate <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> s <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>Nothing</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSignatureImageHist: "</span> <span style='color:#308080; '>+</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"{0}-{1}-{2}-{3}"</span><span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>,</span> histdate<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                s <span style='color:#308080; '>=</span> DirectCast<span style='color:#308080; '>(</span>conn<span style='color:#008c00; '>.</span>Execute<span style='color:#308080; '>(</span>SPNames<span style='color:#008c00; '>.</span>SP_GetSignImageHist<span style='color:#308080; '>,</span> CommandType<span style='color:#008c00; '>.</span>StoredProcedure<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             DBoxSqlConnection<span style='color:#008c00; '>.</span>ExecuteType<span style='color:#008c00; '>.</span>ExecuteScalar<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                             type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>,</span> signId<span style='color:#308080; '>,</span> histdate<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> s
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetAccViewGroup<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"SELECT AcctType, AcctNumLength, SortOrder FROM AcctTypeMaster WITH(NOLOCK) ORDER BY SortOrder"</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> ExecuteSQLReader<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSuspendInfo<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetSuspendInfo<span style='color:#308080; '>,</span> type<span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSuspendInfo: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>

        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetUserInfo<span style='color:#308080; '>(</span>userid <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetUserInfo<span style='color:#308080; '>,</span> userid<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetUserInfo: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>

        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetSessionInfo<span style='color:#308080; '>(</span>sessionid <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> minimal <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>If</span> <span style='color:#200080; font-weight:bold; '>Not</span> sessionid<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>=</span> <span style='color:#008c00; '>36</span> <span style='color:#200080; font-weight:bold; '>Then</span>   <span style='color:#595979; '>' Must be 36-char len for GUID</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> dt
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>

                <span style='color:#200080; font-weight:bold; '>If</span> minimal <span style='color:#200080; font-weight:bold; '>Then</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} NULL, '{1}', '1'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetUserInfo<span style='color:#308080; '>,</span> sessionid<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Else</span>
                    sql <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} NULL, '{1}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_GetUserInfo<span style='color:#308080; '>,</span> sessionid<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"GetSessionInfo: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> dt
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> UpdateSession<span style='color:#308080; '>(</span>sessionid <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>If</span> <span style='color:#200080; font-weight:bold; '>Not</span> sessionid<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>=</span> <span style='color:#008c00; '>36</span> <span style='color:#200080; font-weight:bold; '>Then</span>   <span style='color:#595979; '>' Must be 36-char len for GUID</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}'"</span><span style='color:#308080; '>,</span> SPNames<span style='color:#008c00; '>.</span>SP_UpdateSession<span style='color:#308080; '>,</span> sessionid<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"UpdateSession: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> rows <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteNonQuery<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

                <span style='color:#200080; font-weight:bold; '>If</span> rows <span style='color:#308080; '>=</span> <span style='color:#008c00; '>1</span> <span style='color:#200080; font-weight:bold; '>Then</span>
                    <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
                <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetClientIpAddress<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByRef</span> ip <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> remp <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> RemoteEndpointMessageProperty<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Name</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> imp <span style='color:#200080; font-weight:bold; '>As</span> MessageProperties <span style='color:#308080; '>=</span> OperationContext<span style='color:#008c00; '>.</span>Current<span style='color:#008c00; '>.</span>IncomingMessageProperties
            <span style='color:#200080; font-weight:bold; '>Dim</span> client_ep <span style='color:#200080; font-weight:bold; '>As</span> RemoteEndpointMessageProperty <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>CType</span><span style='color:#308080; '>(</span>imp<span style='color:#308080; '>(</span>remp<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> RemoteEndpointMessageProperty<span style='color:#308080; '>)</span>
            ip <span style='color:#308080; '>=</span> client_ep<span style='color:#008c00; '>.</span>Address
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"Unable to get client IP Address."</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> GetWorkStationId<span style='color:#308080; '>(</span>ip <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByRef</span> wid <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            wid <span style='color:#308080; '>=</span> Dns<span style='color:#008c00; '>.</span>GetHostEntry<span style='color:#308080; '>(</span>ip<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>HostName
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"Unable to get client workstation Id."</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> LogView<span style='color:#308080; '>(</span>type <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> number <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> user <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> workid <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> ip <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> teller <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> rmk <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>If</span> IsStressTestMode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

        <span style='color:#200080; font-weight:bold; '>Dim</span> cifNo <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"NULL"</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> accTy <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"NULL"</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> accNo <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"NULL"</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> proId <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"NULL"</span>

        <span style='color:#200080; font-weight:bold; '>If</span> type <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"cif"</span> <span style='color:#200080; font-weight:bold; '>Then</span>
            cifNo <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>""</span><span style='color:#1060b6; '>"{0}"</span><span style='color:#1060b6; '>""</span><span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>ElseIf</span> type <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"time"</span> <span style='color:#200080; font-weight:bold; '>Then</span>
            proId <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>""</span><span style='color:#1060b6; '>"{0}"</span><span style='color:#1060b6; '>""</span><span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Else</span>
            accTy <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>""</span><span style='color:#1060b6; '>"{0}"</span><span style='color:#1060b6; '>""</span><span style='color:#308080; '>,</span> type<span style='color:#308080; '>)</span>
            accNo <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>""</span><span style='color:#1060b6; '>"{0}"</span><span style='color:#1060b6; '>""</span><span style='color:#308080; '>,</span> number<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>

        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', '{3}', {4}, {5}, {6}, {7}, '{8}', '{9}'"</span><span style='color:#308080; '>,</span>
                SPNames<span style='color:#008c00; '>.</span>SP_LogView<span style='color:#308080; '>,</span> user<span style='color:#308080; '>,</span> workid<span style='color:#308080; '>,</span> ip<span style='color:#308080; '>,</span> cifNo<span style='color:#308080; '>,</span> accTy<span style='color:#308080; '>,</span> accNo<span style='color:#308080; '>,</span> proId<span style='color:#308080; '>,</span> teller<span style='color:#308080; '>,</span> rmk<span style='color:#308080; '>)</span>

                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"LogView: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteNonQuery<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> InsertSession<span style='color:#308080; '>(</span>user <span style='color:#200080; font-weight:bold; '>As</span> LoginResponse<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> dt <span style='color:#200080; font-weight:bold; '>As</span> DataTable <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> DataTable
        <span style='color:#200080; font-weight:bold; '>Dim</span> session_id <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Open</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Format</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"EXEC dbo.{0} '{1}', '{2}', '{3}'"</span><span style='color:#308080; '>,</span>
                SPNames<span style='color:#008c00; '>.</span>SP_InsertSession<span style='color:#308080; '>,</span> user<span style='color:#008c00; '>.</span>username<span style='color:#308080; '>,</span> user<span style='color:#008c00; '>.</span>workstation<span style='color:#308080; '>,</span> user<span style='color:#008c00; '>.</span>ip_address<span style='color:#308080; '>)</span>

                <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>Info<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"InsertSession: "</span> <span style='color:#308080; '>+</span> sql<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>command</span> <span style='color:#200080; font-weight:bold; '>As</span> SqlCommand <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> SqlCommand<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> conn<span style='color:#008c00; '>.</span>InnerSQLConnection<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> dr <span style='color:#200080; font-weight:bold; '>As</span> SqlDataReader <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>ExecuteReader<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                dt<span style='color:#008c00; '>.</span>Load<span style='color:#308080; '>(</span>dr<span style='color:#308080; '>)</span>
                dr<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>command</span><span style='color:#008c00; '>.</span>Dispose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
                conn<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Close</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using

            <span style='color:#200080; font-weight:bold; '>If</span> <span style='color:#308080; '>(</span>dt<span style='color:#008c00; '>.</span>Rows<span style='color:#008c00; '>.</span>Count <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
                session_id <span style='color:#308080; '>=</span> dt<span style='color:#008c00; '>.</span>Rows<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>Item<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"sessionid"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>ToString
                session_id <span style='color:#308080; '>=</span> session_id<span style='color:#008c00; '>.</span>ToUpper<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> session_id
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> IsSessionTimeout<span style='color:#308080; '>(</span>unixtime <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Long</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> dtLast <span style='color:#200080; font-weight:bold; '>As</span> DateTime <span style='color:#308080; '>=</span> DAL<span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span>FromUnixTime<span style='color:#308080; '>(</span>unixtime<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> dtDiff <span style='color:#308080; '>=</span> DateTime<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Now</span> <span style='color:#308080; '>-</span> dtLast

        <span style='color:#200080; font-weight:bold; '>If</span> <span style='color:#308080; '>(</span>dtDiff<span style='color:#008c00; '>.</span>Minutes <span style='color:#308080; '>></span> <span style='color:#200080; font-weight:bold; '>Me</span><span style='color:#008c00; '>.</span>SessionTimeout<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> DecryptImage<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByRef</span> image <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>Try</span>
            <span style='color:#200080; font-weight:bold; '>Dim</span> cm <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> SVSCrypto<span style='color:#008c00; '>.</span>CryptoModule
            <span style='color:#200080; font-weight:bold; '>Dim</span> actual_key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>""</span>   <span style='color:#595979; '>'"123456789012345678901234"</span>

            Using conn <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> DBoxSqlConnection<span style='color:#308080; '>(</span>SqlConnStr_SignDB<span style='color:#308080; '>)</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> sql <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"SELECT keyValue from DBEncryptKey"</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> keyBytes0 <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> DirectCast<span style='color:#308080; '>(</span>conn<span style='color:#008c00; '>.</span>Execute<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> CommandType<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>_</span>
                    DBoxSqlConnection<span style='color:#008c00; '>.</span>ExecuteType<span style='color:#008c00; '>.</span>ExecuteScalar<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
                actual_key <span style='color:#308080; '>=</span> cm<span style='color:#008c00; '>.</span>UnMassageKey<span style='color:#308080; '>(</span>keyBytes0<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>End</span> Using

            image <span style='color:#308080; '>=</span> cm<span style='color:#008c00; '>.</span>DecryptTripleDES<span style='color:#308080; '>(</span>actual_key<span style='color:#308080; '>,</span> image<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
        <span style='color:#200080; font-weight:bold; '>Catch</span> ex <span style='color:#200080; font-weight:bold; '>As</span> Exception
            <span style='color:#200080; font-weight:bold; '>Log</span><span style='color:#008c00; '>.</span>Instance<span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Error</span><span style='color:#308080; '>(</span>ex<span style='color:#008c00; '>.</span>Message<span style='color:#308080; '>)</span>
            <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
        <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Try</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

<span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Class</span>
</pre>
<!--Created using ToHtml.com on 2021-08-04 06:51:53 UTC -->