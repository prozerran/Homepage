<pre style='color:#000000;background:#ffffff;'><span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Author:  Yee Hsu</span>
<span style='color:#008000; '>// Date:    9/5/2008</span>
<span style='color:#008000; '>// File:    HTTP.cpp</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Desc:    HTTP wrapper that does simple HTTP API calls. Now we have an HTTP</span>
<span style='color:#008000; '>//          object we can call and use to make HTTP connections, make HTTP</span>
<span style='color:#008000; '>//          requests via the HTTP protocol</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#008000; '>// GenericHTTPClient.cpp: implementation of the GenericHTTPClient class.</span>
<span style='color:#008000; '>//////////////////////////////////////////////////////////////////////</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>stdafx.h</span><span style='color:#0000e6; '>"</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>CHTTP.h</span><span style='color:#0000e6; '>"</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>&lt;</span><span style='color:#40015a; '>winreg.h</span><span style='color:#0000e6; '>></span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GenericHTTPClient()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: GenericHTTPClient Constructor</span>
<span style='color:#008000; '>// ==========================================================================</span>

GenericHTTPClient<span style='color:#0000ff; '>::</span>GenericHTTPClient<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    _hHTTPOpen<span style='color:#0000ff; '>=</span>_hHTTPConnection<span style='color:#0000ff; '>=</span>_hHTTPRequest<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GenericHTTPClient()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: GenericHTTPClient Destructor</span>
<span style='color:#008000; '>// ==========================================================================</span>

GenericHTTPClient<span style='color:#0000ff; '>::</span><span style='color:#0000ff; '>~</span>GenericHTTPClient<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    _hHTTPOpen<span style='color:#0000ff; '>=</span>_hHTTPConnection<span style='color:#0000ff; '>=</span>_hHTTPRequest<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetMethod()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets the HTTP request method</span>
<span style='color:#008000; '>// ==========================================================================</span>

GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestMethod GenericHTTPClient<span style='color:#0000ff; '>::</span>GetMethod<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>  
    <span style='color:#0000ff; font-weight:bold; '>return</span> nMethod<span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span> <span style='color:#0000ff; '>?</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestGetMethod <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>static_cast</span><span style='color:#0000ff; '>&lt;</span>GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestMethod<span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetPostArgumentType()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets POST argument type</span>
<span style='color:#008000; '>// ==========================================================================</span>

GenericHTTPClient<span style='color:#0000ff; '>::</span>TypePostArgument GenericHTTPClient<span style='color:#0000ff; '>::</span>GetPostArgumentType<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> nType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> nType<span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span> <span style='color:#0000ff; '>?</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>TypeNormal <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>static_cast</span><span style='color:#0000ff; '>&lt;</span>GenericHTTPClient<span style='color:#0000ff; '>::</span>TypePostArgument<span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>nType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  Connect()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes and HTTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>Connect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szAddress<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szAgent<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>short</span> nPort<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szUserAccount<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szPassword<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    _hHTTPOpen<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span>InternetOpen<span style='color:#0000ff; '>(</span>szAgent<span style='color:#0000ff; '>,</span>                        <span style='color:#008000; '>// agent name</span>
                                                INTERNET_OPEN_TYPE_PRECONFIG<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// proxy option</span>
                                                <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span>                            <span style='color:#008000; '>// proxy</span>
                                                <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span>                        <span style='color:#008000; '>// proxy bypass</span>
                                                <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>          <span style='color:#008000; '>// flags</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPOpen<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>  

    _hHTTPConnection<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span>InternetConnect<span style='color:#0000ff; '>(</span>  _hHTTPOpen<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// internet opened handle</span>
                                                            szAddress<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// server name</span>
                                                            nPort<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// ports</span>
                                                            szUserAccount<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// user name</span>
                                                            szPassword<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// password </span>
                                                            INTERNET_SERVICE_HTTP<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// service type</span>
                                                            INTERNET_FLAG_KEEP_CONNECTION <span style='color:#0000ff; '>|</span> INTERNET_FLAG_NO_CACHE_WRITE<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// service option                                                            </span>
                                                            <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>// context call-back option</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPConnection<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>    
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>_hHTTPOpen<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>::</span>InternetAttemptConnect<span style='color:#0000ff; '>(</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>ERROR_SUCCESS</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>    
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>_hHTTPConnection<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>_hHTTPOpen<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>                              
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  Close()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Closes and HTTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>Close<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>::</span>InternetCloseHandle<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>_hHTTPConnection<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>::</span>InternetCloseHandle<span style='color:#0000ff; '>(</span>_hHTTPConnection<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>_hHTTPOpen<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>::</span>InternetCloseHandle<span style='color:#0000ff; '>(</span>_hHTTPOpen<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  Request()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an HTTP request</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>Request<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURL<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>int</span> nMethod<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szAgent<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>BOOL</span> bReturn<span style='color:#0000ff; '>=</span>TRUE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPort<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szProtocol<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szAddress<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>  
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szURI<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwSize<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    ParseURL<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>,</span> szProtocol<span style='color:#0000ff; '>,</span> szAddress<span style='color:#0000ff; '>,</span> dwPort<span style='color:#0000ff; '>,</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>Connect<span style='color:#0000ff; '>(</span>szAddress<span style='color:#0000ff; '>,</span> szAgent<span style='color:#0000ff; '>,</span> dwPort<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>RequestOfURI<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>,</span> nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
            bReturn<span style='color:#0000ff; '>=</span>FALSE<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>Response<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span>_szHTTPResponseHeader<span style='color:#0000ff; '>,</span> __SIZE_HTTP_BUFFER<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span>_szHTTPResponseHTML<span style='color:#0000ff; '>,</span> __SIZE_HTTP_BUFFER<span style='color:#0000ff; '>,</span> dwSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
                bReturn<span style='color:#0000ff; '>=</span>FALSE<span style='color:#0000ff; '>;</span>    
            <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; '>}</span>
        Close<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
        bReturn<span style='color:#0000ff; '>=</span>FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> bReturn<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  RequestOfURI()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an HTTP request of URI</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestOfURI<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURI<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>int</span> nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>BOOL</span> bReturn<span style='color:#0000ff; '>=</span>TRUE<span style='color:#0000ff; '>;</span>

<span style='color:#008000; '>//  try{</span>
        <span style='color:#0000ff; font-weight:bold; '>switch</span><span style='color:#0000ff; '>(</span>nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>RequestGetMethod</span><span style='color:#e34adc; font-weight:bold; '>:</span>
<span style='color:#e34adc; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#0000ff; font-weight:bold; '>default</span><span style='color:#e34adc; '>:</span>
            bReturn<span style='color:#0000ff; '>=</span>RequestGet<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>RequestPostMethod</span><span style='color:#e34adc; font-weight:bold; '>:</span>    
            bReturn<span style='color:#0000ff; '>=</span>RequestPost<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>RequestPostMethodMultiPartsFormData</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            bReturn<span style='color:#0000ff; '>=</span>RequestPostMultiPartsFormData<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span><span style='color:#008000; '>/*</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;}catch(CException *e){</span>
<span style='color:#008000; '>#ifdef  _DEBUG</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;TRACE("\nEXCEPTION\n");</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;TCHAR szERROR[1024];</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;e->GetErrorMessage(szERROR, 1024);</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;TRACE(szERROR);</span>
<span style='color:#008000; '>#endif</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;}</span>
<span style='color:#008000; '>*/</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> bReturn<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  RequestGet()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an HTTP request get</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestGet<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>CONST</span> <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> <span style='color:#0000ff; '>*</span>szAcceptType<span style='color:#0000ff; '>=</span>__HTTP_ACCEPT_TYPE<span style='color:#0000ff; '>;</span>

    _hHTTPRequest<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span>HttpOpenRequest<span style='color:#0000ff; '>(</span>  _hHTTPConnection<span style='color:#0000ff; '>,</span>
                                                            __HTTP_VERB_GET<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// HTTP Verb</span>
                                                            szURI<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Object Name</span>
                                                            HTTP_VERSION<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Version</span>
                                                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Reference</span>
                                                            <span style='color:#0000ff; '>&amp;</span>szAcceptType<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Accept Type</span>
                                                            INTERNET_FLAG_KEEP_CONNECTION <span style='color:#0000ff; '>|</span> INTERNET_FLAG_NO_CACHE_WRITE<span style='color:#0000ff; '>,</span>
                                                            <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// context call-back point</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#008000; '>// REPLACE HEADER</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpAddRequestHeaders<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span> __HTTP_ACCEPT<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>__HTTP_ACCEPT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> HTTP_ADDREQ_FLAG_REPLACE<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE(reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#008000; '>// SEND REQUEST</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpSendRequest<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// handle by returned HttpOpenRequest</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional HTTP header</span>
                                    <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional HTTP header length</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional data in HTTP Post or HTTP Put</span>
                                    <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#008000; '>// additional data length</span>
                                    <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  RequestPost()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an HTTP request post</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestPost<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>CONST</span> <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> <span style='color:#0000ff; '>*</span>szAcceptType<span style='color:#0000ff; '>=</span>__HTTP_ACCEPT_TYPE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span>      szPostArguments<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szContentType<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>TEXT</span><span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Type: application/x-www-form-urlencoded</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPostArgumentsLegnth<span style='color:#0000ff; '>=</span>GetPostArguments<span style='color:#0000ff; '>(</span>szPostArguments<span style='color:#0000ff; '>,</span> __SIZE_BUFFER<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    
    _hHTTPRequest<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span>HttpOpenRequest<span style='color:#0000ff; '>(</span>  _hHTTPConnection<span style='color:#0000ff; '>,</span>
                                                            __HTTP_VERB_POST<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// HTTP Verb</span>
                                                            szURI<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Object Name</span>
                                                            HTTP_VERSION<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Version</span>
                                                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Reference</span>
                                                            <span style='color:#0000ff; '>&amp;</span>szAcceptType<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Accept Type</span>
                                                            INTERNET_FLAG_KEEP_CONNECTION <span style='color:#0000ff; '>|</span> INTERNET_FLAG_NO_CACHE_WRITE <span style='color:#0000ff; '>|</span> INTERNET_FLAG_FORMS_SUBMIT<span style='color:#0000ff; '>,</span>
                                                            <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// context call-back point</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE("\n%d : %s\n", _dwError, reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#008000; '>// REPLACE HEADER</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpAddRequestHeaders<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span> __HTTP_ACCEPT<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>__HTTP_ACCEPT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> HTTP_ADDREQ_FLAG_REPLACE<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE("\n%d : %s\n", _dwError, reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>


    <span style='color:#008000; '>// SEND REQUEST</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpSendRequest<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// handle by returned HttpOpenRequest</span>
                                    szContentType<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional HTTP header</span>
                                    _tcslen<span style='color:#0000ff; '>(</span>szContentType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional HTTP header length</span>
                                    <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPVOID</span><span style='color:#0000ff; '>)</span>szPostArguments<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// additional data in HTTP Post or HTTP Put</span>
                                    _tcslen<span style='color:#0000ff; '>(</span>szPostArguments<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span> <span style='color:#008000; '>// additional data length</span>
                                    <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE("\n%d : %s\n", _dwError, reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  RequestPostMultiPartsFormData()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an HTTP request post multi part data</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>RequestPostMultiPartsFormData<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>CONST</span> <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> <span style='color:#0000ff; '>*</span>szAcceptType<span style='color:#0000ff; '>=</span>__HTTP_ACCEPT_TYPE<span style='color:#0000ff; '>;</span>  
    <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szContentType<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>TEXT</span><span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Type: multipart/form-data; boundary=--MULTI-PARTS-FORM-DATA-BOUNDARY</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
    
    <span style='color:#008000; '>// ALLOCATE POST MULTI-PARTS FORM DATA ARGUMENTS</span>
    <span style='color:#0000ff; font-weight:bold; '>PBYTE</span> pPostBuffer<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPostBufferLength<span style='color:#0000ff; '>=</span>AllocMultiPartsFormData<span style='color:#0000ff; '>(</span>pPostBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>--MULTI-PARTS-FORM-DATA-BOUNDARY</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    _hHTTPRequest<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span>HttpOpenRequest<span style='color:#0000ff; '>(</span>  _hHTTPConnection<span style='color:#0000ff; '>,</span>
                                                            __HTTP_VERB_POST<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// HTTP Verb</span>
                                                            szURI<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Object Name</span>
                                                            HTTP_VERSION<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Version</span>
                                                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Reference</span>
                                                            <span style='color:#0000ff; '>&amp;</span>szAcceptType<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// Accept Type</span>
                                                            INTERNET_FLAG_KEEP_CONNECTION <span style='color:#0000ff; '>|</span> INTERNET_FLAG_NO_CACHE_WRITE <span style='color:#0000ff; '>|</span> INTERNET_FLAG_FORMS_SUBMIT<span style='color:#0000ff; '>,</span>  <span style='color:#008000; '>// flags</span>
                                                            <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// context call-back point</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#008000; '>// REPLACE HEADER</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpAddRequestHeaders<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span> __HTTP_ACCEPT<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>__HTTP_ACCEPT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> HTTP_ADDREQ_FLAG_REPLACE<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE(reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpAddRequestHeaders<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span> szContentType<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>szContentType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> HTTP_ADDREQ_FLAG_ADD_IF_NEW<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE(reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span>  szContentLength<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>szContentLength<span style='color:#0000ff; '>,</span> __SIZE_BUFFER<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    _stprintf<span style='color:#0000ff; '>(</span> szContentLength<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Length: </span><span style='color:#007997; '>%d</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> dwPostBufferLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpAddRequestHeaders<span style='color:#0000ff; '>(</span> _hHTTPRequest<span style='color:#0000ff; '>,</span> szContentLength<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>szContentLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> HTTP_ADDREQ_FLAG_ADD_IF_NEW<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE(reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span>  szHTTPRequest<span style='color:#0000ff; '>[</span>__SIZE_HTTP_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwHTTPRequestLength<span style='color:#0000ff; '>=</span>__SIZE_HTTP_BUFFER<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>szHTTPRequest<span style='color:#0000ff; '>,</span> __SIZE_HTTP_BUFFER<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpQueryInfo<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>,</span> HTTP_QUERY_RAW_HEADERS_CRLF<span style='color:#0000ff; '>,</span> szHTTPRequest<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwHTTPRequestLength<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE("\n%d : %s\n", ::GetLastError(), reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
        <span style='color:#008000; '>//return FALSE;</span>
    <span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>//  TRACE(szHTTPRequest);</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>

    <span style='color:#008000; '>// SEND REQUEST WITH HttpSendRequestEx and InternetWriteFile</span>
    INTERNET_BUFFERS InternetBufferIn<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>{</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>}</span><span style='color:#0000ff; '>;</span>
    InternetBufferIn<span style='color:#0000ff; '>.</span>dwStructSize<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span>INTERNET_BUFFERS<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    InternetBufferIn<span style='color:#0000ff; '>.</span>Next<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>  
    
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpSendRequestEx<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>InternetBufferIn<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> HSR_INITIATE<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#008000; '>//    TRACE(reinterpret_cast&lt;LPTSTR>(lpMsgBuffer));</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwOutPostBufferLength<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>InternetWriteFile<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>,</span> pPostBuffer<span style='color:#0000ff; '>,</span> dwPostBufferLength<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwOutPostBufferLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpEndRequest<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> HSR_INITIATE<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#008000; '>// FREE POST MULTI-PARTS FORM DATA ARGUMENTS</span>
    FreeMultiPartsFormData<span style='color:#0000ff; '>(</span>pPostBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ResponseOfBytes()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: HTTP response in bytes</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>ResponseOfBytes<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span> pBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>static</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwBytes<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>,</span> dwSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>InternetReadFile<span style='color:#0000ff; '>(</span>  _hHTTPRequest<span style='color:#0000ff; '>,</span>
                                    pBuffer<span style='color:#0000ff; '>,</span>
                                    dwSize<span style='color:#0000ff; '>,</span>
                                    <span style='color:#0000ff; '>&amp;</span>dwBytes<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> dwBytes<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  Response()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: HTTP response</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>Response<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span> pHeaderBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwHeaderBufferLength<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>PBYTE</span> pBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwBufferLength<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> <span style='color:#0000ff; '>&amp;</span>dwResultSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>BYTE</span> pResponseBuffer<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>  
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwNumOfBytesToRead<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_hHTTPRequest<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG    </span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>,</span> dwBufferLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    dwResultSize<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>dwNumOfBytesToRead<span style='color:#0000ff; '>=</span>ResponseOfBytes<span style='color:#0000ff; '>(</span>pResponseBuffer<span style='color:#0000ff; '>,</span> __SIZE_BUFFER<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> dwResultSize<span style='color:#0000ff; '>&lt;</span>dwBufferLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>+</span>dwResultSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> pResponseBuffer<span style='color:#0000ff; '>,</span> dwNumOfBytesToRead<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
        dwResultSize<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>dwNumOfBytesToRead<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>pHeaderBuffer<span style='color:#0000ff; '>,</span> dwHeaderBufferLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>HttpQueryInfo<span style='color:#0000ff; '>(</span>_hHTTPRequest<span style='color:#0000ff; '>,</span> HTTP_QUERY_RAW_HEADERS_CRLF<span style='color:#0000ff; '>,</span> pHeaderBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwHeaderBufferLength<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _dwError<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>ifdef</span><span style='color:#004a43; '>  _DEBUG</span>
        <span style='color:#0000ff; font-weight:bold; '>LPVOID</span>     lpMsgBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwRet<span style='color:#0000ff; '>=</span><span style='color:#0000ff; font-weight:bold; '>FormatMessage</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_ALLOCATE_BUFFER</span> <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FORMAT_MESSAGE_FROM_SYSTEM</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>MAKELANGID</span><span style='color:#0000ff; '>(</span>LANG_NEUTRAL<span style='color:#0000ff; '>,</span> SUBLANG_DEFAULT<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span>
                                                          <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>OutputDebugString</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>reinterpret_cast</span><span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>lpMsgBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>    
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>endif</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; '>(</span>dwResultSize<span style='color:#0000ff; '>?</span> TRUE<span style='color:#0000ff; '>:</span> FALSE<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  AddPostArguments()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Add post arguments to HTTP request</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>VOID</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>AddPostArguments<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szName<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szValue<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>BOOL</span> bBinary<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    GenericHTTPArgument  <span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    _tcscpy<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>szName<span style='color:#0000ff; '>,</span> szName<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    _tcscpy<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>szValue<span style='color:#0000ff; '>,</span> szValue<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>bBinary<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>dwType <span style='color:#0000ff; '>=</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>TypeNormal<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span>
        <span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>dwType <span style='color:#0000ff; '>=</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>TypeBinary<span style='color:#0000ff; '>;</span>  

    _vArguments<span style='color:#0000ff; '>.</span>push_back<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  AddPostArguments()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Add post arguments to HTTP request</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>VOID</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>AddPostArguments<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szName<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> nValue<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    GenericHTTPArgument  <span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>FillMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0x00</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    _tcscpy<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>szName<span style='color:#0000ff; '>,</span> szName<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    _stprintf<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>szValue<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#007997; '>%d</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> nValue<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>.</span>dwType <span style='color:#0000ff; '>=</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>TypeNormal<span style='color:#0000ff; '>;</span>

    _vArguments<span style='color:#0000ff; '>.</span>push_back<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>arg</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetPostArguments()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Get post arguments to HTTP request</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>GetPostArguments<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPTSTR</span> szArguments<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>vector</span><span style='color:#0000ff; '>&lt;</span>GenericHTTPArgument<span style='color:#0000ff; '>></span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>iterator</span> itArg<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>,</span> dwLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span><span style='color:#0000ff; '>(</span>itArg<span style='color:#0000ff; '>=</span>_vArguments<span style='color:#0000ff; '>.</span>begin<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> itArg<span style='color:#0000ff; '>&lt;</span>_vArguments<span style='color:#0000ff; '>.</span>end<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        _tcscat<span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>,</span> itArg<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szName<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        _tcscat<span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        _tcscat<span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>,</span> itArg<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span>itArg<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>&lt;</span>_vArguments<span style='color:#0000ff; '>.</span>end<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
            _tcscat<span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>&amp;</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>+</span>dwLength<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>=</span><span style='color:#000080; '>'\0'</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> _tcslen<span style='color:#0000ff; '>(</span>szArguments<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  InitilizePostArguments()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Initialize post arguments</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>VOID</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>InitilizePostArguments<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    _vArguments<span style='color:#0000ff; '>.</span>clear<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FreeMultiPartsFormData()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Frees the multi parts data</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>VOID</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>FreeMultiPartsFormData<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span> <span style='color:#0000ff; '>&amp;</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        pBuffer<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  AllocMultiPartsFormData()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Allocates the multi parts data</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>AllocMultiPartsFormData<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span> <span style='color:#0000ff; '>&amp;</span>pInBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szBoundary<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        pInBuffer<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    pInBuffer<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalAlloc</span><span style='color:#0000ff; '>(</span>LPTR<span style='color:#0000ff; '>,</span> GetMultiPartsFormDataLength<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  
    std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>vector</span><span style='color:#0000ff; '>&lt;</span>GenericHTTPArgument<span style='color:#0000ff; '>></span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>iterator</span> itArgv<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPosition<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwBufferSize<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>=</span>_vArguments<span style='color:#0000ff; '>.</span>begin<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> itArgv<span style='color:#0000ff; '>&lt;</span>_vArguments<span style='color:#0000ff; '>.</span>end<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span>itArgv<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

        <span style='color:#0000ff; font-weight:bold; '>PBYTE</span> pBuffer<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>

        <span style='color:#008000; '>// SET MULTI_PRATS FORM DATA BUFFER</span>
        <span style='color:#0000ff; font-weight:bold; '>switch</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>TypeNormal</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            pBuffer<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalAlloc</span><span style='color:#0000ff; '>(</span>LPTR<span style='color:#0000ff; '>,</span> __SIZE_HTTP_HEAD_LINE<span style='color:#0000ff; '>*</span><span style='color:#800000; '>4</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            _stprintf<span style='color:#0000ff; '>(</span>  <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>TCHAR</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span>pBuffer<span style='color:#0000ff; '>,</span>              
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>--</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Disposition: form-data; name=</span><span style='color:#0000e6; '>\"</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span>
                            szBoundary<span style='color:#0000ff; '>,</span>
                            itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szName<span style='color:#0000ff; '>,</span>
                            itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            dwBufferSize<span style='color:#0000ff; '>=</span>_tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>TCHAR</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>TypeBinary</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwNumOfBytesToRead<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwTotalBytes<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

            <span style='color:#0000ff; font-weight:bold; '>HANDLE</span> hFile<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CreateFile</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>,</span> 
                                    <span style='color:#808080; font-weight:bold; '>GENERIC_READ</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// desired access</span>
                                    FILE_SHARE_READ<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// share mode</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// security attribute</span>
                                    <span style='color:#808080; font-weight:bold; '>OPEN_EXISTING</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// create disposition</span>
                                    FILE_ATTRIBUTE_NORMAL <span style='color:#0000ff; '>|</span> <span style='color:#808080; font-weight:bold; '>FILE_FLAG_SEQUENTIAL_SCAN</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// flag and attributes</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// template file handle</span>

            <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwSize<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetFileSize</span><span style='color:#0000ff; '>(</span>hFile<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            pBuffer<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalAlloc</span><span style='color:#0000ff; '>(</span>LPTR<span style='color:#0000ff; '>,</span> __SIZE_HTTP_HEAD_LINE<span style='color:#0000ff; '>*</span><span style='color:#800000; '>3</span><span style='color:#0000ff; '>+</span>dwSize<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>BYTE</span>  pBytes<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
            
            _stprintf<span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>TCHAR</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span>pBuffer<span style='color:#0000ff; '>,</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>--</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Disposition: form-data; name=</span><span style='color:#0000e6; '>\"</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\"</span><span style='color:#0000e6; '>; filename=</span><span style='color:#0000e6; '>\"</span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content-Type: </span><span style='color:#007997; '>%s</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span>
                            <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span>
                            szBoundary<span style='color:#0000ff; '>,</span>
                            itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szName<span style='color:#0000ff; '>,</span> itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>,</span>
                            GetContentType<span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>)</span>
                            <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwBufPosition<span style='color:#0000ff; '>=</span>_tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>TCHAR</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  
    
            <span style='color:#0000ff; font-weight:bold; '>while</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ReadFile</span><span style='color:#0000ff; '>(</span>hFile<span style='color:#0000ff; '>,</span> pBytes<span style='color:#0000ff; '>,</span> __SIZE_BUFFER<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwNumOfBytesToRead<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> dwNumOfBytesToRead<span style='color:#0000ff; '>></span><span style='color:#800000; '>0</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> dwTotalBytes<span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span>dwSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
                <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>+</span>dwBufPosition<span style='color:#0000ff; '>+</span>dwTotalBytes<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> pBytes<span style='color:#0000ff; '>,</span> dwNumOfBytesToRead<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>ZeroMemory</span><span style='color:#0000ff; '>(</span>pBytes<span style='color:#0000ff; '>,</span> __SIZE_BUFFER<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                dwTotalBytes<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>dwNumOfBytesToRead<span style='color:#0000ff; '>;</span>        
            <span style='color:#0000ff; '>}</span>

            <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>+</span>dwBufPosition<span style='color:#0000ff; '>+</span>dwTotalBytes<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>hFile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            dwBufferSize<span style='color:#0000ff; '>=</span>dwBufPosition<span style='color:#0000ff; '>+</span>dwTotalBytes<span style='color:#0000ff; '>+</span>_tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>      
        <span style='color:#0000ff; '>}</span>

        <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> pBuffer<span style='color:#0000ff; '>,</span> dwBufferSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        dwPosition<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>dwBufferSize<span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>LocalFree</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            pBuffer<span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>--</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>2</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>+</span><span style='color:#800000; '>2</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> szBoundary<span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>szBoundary<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CopyMemory</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pInBuffer<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>+</span><span style='color:#800000; '>2</span><span style='color:#0000ff; '>+</span>_tcslen<span style='color:#0000ff; '>(</span>szBoundary<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>--</span><span style='color:#0000e6; '>\r</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>3</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> dwPosition<span style='color:#0000ff; '>+</span><span style='color:#800000; '>5</span><span style='color:#0000ff; '>+</span>_tcslen<span style='color:#0000ff; '>(</span>szBoundary<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetMultiPartsFormDataLength()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets the multi parts data</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>GetMultiPartsFormDataLength<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>vector</span><span style='color:#0000ff; '>&lt;</span>GenericHTTPArgument<span style='color:#0000ff; '>></span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>iterator</span> itArgv<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwLength<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>=</span>_vArguments<span style='color:#0000ff; '>.</span>begin<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> itArgv<span style='color:#0000ff; '>&lt;</span>_vArguments<span style='color:#0000ff; '>.</span>end<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span>itArgv<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

        <span style='color:#0000ff; font-weight:bold; '>switch</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwType<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>TypeNormal</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            dwLength<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>__SIZE_HTTP_HEAD_LINE<span style='color:#0000ff; '>*</span><span style='color:#800000; '>4</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>case </span><span style='color:#808080; font-weight:bold; '> GenericHTTPClient</span><span style='color:#0000ff; font-weight:bold; '>::</span><span style='color:#808080; font-weight:bold; '>TypeBinary</span><span style='color:#e34adc; font-weight:bold; '>:</span>
            <span style='color:#0000ff; font-weight:bold; '>HANDLE</span> hFile<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CreateFile</span><span style='color:#0000ff; '>(</span>itArgv<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szValue<span style='color:#0000ff; '>,</span> 
                                    <span style='color:#808080; font-weight:bold; '>GENERIC_READ</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// desired access</span>
                                    FILE_SHARE_READ<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// share mode</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// security attribute</span>
                                    <span style='color:#808080; font-weight:bold; '>OPEN_EXISTING</span><span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// create disposition</span>
                                    FILE_ATTRIBUTE_NORMAL<span style='color:#0000ff; '>,</span> <span style='color:#008000; '>// flag and attributes</span>
                                    <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span> <span style='color:#008000; '>// template file handle</span>

            dwLength<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>__SIZE_HTTP_HEAD_LINE<span style='color:#0000ff; '>*</span><span style='color:#800000; '>3</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetFileSize</span><span style='color:#0000ff; '>(</span>hFile<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>hFile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>      
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> dwLength<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetContentType()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets the content type</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>GetContentType<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szName<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>static</span> <span style='color:#0000ff; font-weight:bold; '>TCHAR</span>  szReturn<span style='color:#0000ff; '>[</span><span style='color:#800000; '>1024</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>LONG</span>  dwLen<span style='color:#0000ff; '>=</span><span style='color:#800000; '>1024</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span>  dwDot<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span><span style='color:#0000ff; '>(</span>dwDot<span style='color:#0000ff; '>=</span>_tcslen<span style='color:#0000ff; '>(</span>szName<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>dwDot<span style='color:#0000ff; '>></span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>dwDot<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_tcsncmp<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>szName<span style='color:#0000ff; '>+</span>dwDot<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>.</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>HKEY</span>  hKEY<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>LPTSTR</span>  szWord<span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>char</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>(</span>szName<span style='color:#0000ff; '>+</span>dwDot<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>RegOpenKeyEx</span><span style='color:#0000ff; '>(</span><span style='color:#808080; font-weight:bold; '>HKEY_CLASSES_ROOT</span><span style='color:#0000ff; '>,</span> szWord<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>KEY_QUERY_VALUE</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>hKEY<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>ERROR_SUCCESS</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>RegQueryValueEx</span><span style='color:#0000ff; '>(</span>hKEY<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>TEXT</span><span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Content Type</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPBYTE</span><span style='color:#0000ff; '>)</span>szReturn<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span><span style='color:#0000ff; '>*</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>&amp;</span>dwLen<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span><span style='color:#808080; font-weight:bold; '>ERROR_SUCCESS</span><span style='color:#0000ff; '>)</span>
            _tcsncpy<span style='color:#0000ff; '>(</span>szReturn<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>application/octet-stream</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>application/octet-stream</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>RegCloseKey</span><span style='color:#0000ff; '>(</span>hKEY<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>szReturn<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>application/octet-stream</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>application/octet-stream</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> szReturn<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetLastError()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets the last error</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> GenericHTTPClient<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetLastError</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> _dwError<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ParseURL()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Parse the URL</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>VOID</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>ParseURL<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURL<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPTSTR</span> szProtocol<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPTSTR</span> szAddress<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>DWORD</span> <span style='color:#0000ff; '>&amp;</span>dwPort<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPTSTR</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>

    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szPort<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPosition<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>BOOL</span> bFlag<span style='color:#0000ff; '>=</span>FALSE<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>while</span><span style='color:#0000ff; '>(</span>_tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>></span><span style='color:#800000; '>0</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> dwPosition<span style='color:#0000ff; '>&lt;</span>_tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> _tcsncmp<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_tcsncmp<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>/</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>  <span style='color:#008000; '>// is PROTOCOL</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>szProtocol<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
            _tcsncpy<span style='color:#0000ff; '>(</span>szProtocol<span style='color:#0000ff; '>,</span> szURL<span style='color:#0000ff; '>,</span> dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            szProtocol<span style='color:#0000ff; '>[</span>dwPosition<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
        bFlag<span style='color:#0000ff; '>=</span>TRUE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>  <span style='color:#008000; '>// is HOST </span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>szProtocol<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
            _tcsncpy<span style='color:#0000ff; '>(</span>szProtocol<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>http</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>4</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            szProtocol<span style='color:#0000ff; '>[</span><span style='color:#800000; '>5</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwStartPosition<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>bFlag<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        dwStartPosition<span style='color:#0000ff; '>=</span>dwPosition<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>3</span><span style='color:#0000ff; '>;</span>        
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
        dwStartPosition<span style='color:#0000ff; '>=</span>dwPosition<span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    bFlag<span style='color:#0000ff; '>=</span>FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span><span style='color:#0000ff; '>(</span>_tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>></span><span style='color:#800000; '>0</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> dwPosition<span style='color:#0000ff; '>&lt;</span>_tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> _tcsncmp<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>/</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
            <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwFind<span style='color:#0000ff; '>=</span>dwStartPosition<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>;</span>dwFind<span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span>dwPosition<span style='color:#0000ff; '>;</span>dwFind<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_tcsncmp<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwFind<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>:</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span> <span style='color:#008000; '>// find PORT</span>
            bFlag<span style='color:#0000ff; '>=</span>TRUE<span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>bFlag<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> sztmp<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>sztmp<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwFind<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> dwPosition<span style='color:#0000ff; '>-</span>dwFind<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        dwPort<span style='color:#0000ff; '>=</span>_ttol<span style='color:#0000ff; '>(</span>sztmp<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>szAddress<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> dwFind<span style='color:#0000ff; '>-</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span>_tcscmp<span style='color:#0000ff; '>(</span>szProtocol<span style='color:#0000ff; '>,</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>https</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
        dwPort<span style='color:#0000ff; '>=</span>INTERNET_DEFAULT_HTTPS_PORT<span style='color:#0000ff; '>;</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>szAddress<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> dwPosition<span style='color:#0000ff; '>-</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
        dwPort<span style='color:#0000ff; '>=</span>INTERNET_DEFAULT_HTTP_PORT<span style='color:#0000ff; '>;</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>szAddress<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> dwPosition<span style='color:#0000ff; '>-</span>dwStartPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span>dwPosition<span style='color:#0000ff; '>&lt;</span>_tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span> <span style='color:#008000; '>// find URI</span>
        _tcsncpy<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>+</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> _tcslen<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>-</span>dwPosition<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span><span style='color:#0000ff; font-weight:bold; '>else</span><span style='color:#0000ff; '>{</span>
        szURI<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>=</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  QueryHTTPResponseHeader()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets HTTP response header</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>QueryHTTPResponseHeader<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> _szHTTPResponseHeader<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  QueryHTTPResponse()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets HTTP response</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> GenericHTTPClient<span style='color:#0000ff; '>::</span>QueryHTTPResponse<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> _szHTTPResponseHTML<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>/* *************************** MODIFIED CODE BEFLOW *************************** */</span>

<span style='color:#008000; '>// HTTP Request uses threading to simulate timeout.</span>
<span style='color:#008000; '>// Timeout is used to prevent an HTTP request to hang while the server never responses.</span>
<span style='color:#008000; '>// Without timeout, this is potentially dangerous as the program execution may halt for a very long</span>
<span style='color:#008000; '>// time. We reimplement Request() with threads for timeouts.</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  HTTP()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: HTTP Constructor</span>
<span style='color:#008000; '>// ==========================================================================</span>

HTTP<span style='color:#0000ff; '>::</span>HTTP<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadId            <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadExitCode      <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadIdleMSec      <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>2000</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>   <span style='color:#008000; '>// Default Timeout: 1 minute</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bHTTPSuccess          <span style='color:#0000ff; '>=</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>nMethod               <span style='color:#0000ff; '>=</span> HTTP<span style='color:#0000ff; '>::</span>RequestGetMethod<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szAgent               <span style='color:#0000ff; '>=</span> __DEFAULT_AGENT_NAME<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szURL                 <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szHTTPUser            <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szHTTPPass            <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  Request()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: HTTP request method</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> HTTP<span style='color:#0000ff; '>::</span>Request<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szURL<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szHTTPUSER<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>LPCTSTR</span> szHTTPPass<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szURL <span style='color:#0000ff; '>=</span> szURL<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bHTTPSuccess <span style='color:#0000ff; '>=</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szHTTPUser <span style='color:#0000ff; '>=</span> szHTTPUSER<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>szHTTPPass <span style='color:#0000ff; '>=</span> szHTTPPass<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>HANDLE</span> hThread <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>CreateThread</span><span style='color:#0000ff; '>(</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPTHREAD_START_ROUTINE</span><span style='color:#0000ff; '>)</span> ThreadStart<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>lpThreadId<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; font-weight:bold; '>WaitForSingleObject</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>,</span> lpThreadIdleMSec<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> WAIT_TIMEOUT<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        HTTP<span style='color:#0000ff; '>::</span>Close<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>WaitForSingleObject</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>,</span> lpThreadIdleMSec<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bHTTPSuccess <span style='color:#0000ff; '>=</span> FALSE<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bHTTPSuccess<span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>// returns TRUE (in mult-threaded code) when HTTP request success</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  LoadPage()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: loads a page in a browser</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> HTTP<span style='color:#0000ff; '>::</span>LoadPage<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>LPCSTR</span> szURL<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>ShellExecute</span><span style='color:#0000ff; '>(</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>open</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> szURL<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>C:</span><span style='color:#0000e6; '>\\</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>SW_SHOW</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> TRUE<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetResponseStatusCode()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets status code from response</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>LONG</span> HTTP<span style='color:#0000ff; '>::</span>GetResponseStatusCode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>LONG</span> lgStatusCode <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>sscanf</span><span style='color:#0000ff; '>(</span>_szHTTPResponseHeader<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#007997; '>%*s</span><span style='color:#0000e6; '> </span><span style='color:#007997; '>%ld</span><span style='color:#0000e6; '> </span><span style='color:#007997; '>%*s</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>lgStatusCode<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> lgStatusCode<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetResponseHeaderInfo()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets response header information</span>
<span style='color:#008000; '>// ==========================================================================</span>

std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> HTTP<span style='color:#0000ff; '>::</span>GetResponseHeaderInfo<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sHeaderInfo<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>::</span>size_type pos<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>string</span> sResponseInfo    <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>string</span> sResponseHeader  <span style='color:#0000ff; '>=</span> _szHTTPResponseHeader<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>string</span> sHeadInfo        <span style='color:#0000ff; '>=</span> sHeaderInfo<span style='color:#0000ff; '>;</span>

    sHeadInfo<span style='color:#0000ff; '>.</span>insert<span style='color:#0000ff; '>(</span>sHeadInfo<span style='color:#0000ff; '>.</span>length<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>: </span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>pos <span style='color:#0000ff; '>=</span> sResponseHeader<span style='color:#0000ff; '>.</span><span style='color:#0000ff; font-weight:bold; '>find</span><span style='color:#0000ff; '>(</span> sHeadInfo <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> sResponseHeader<span style='color:#0000ff; '>.</span><span style='color:#808080; font-weight:bold; '>npos</span> <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        sResponseInfo <span style='color:#0000ff; '>=</span> sResponseHeader<span style='color:#0000ff; '>.</span>erase<span style='color:#0000ff; '>(</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> pos <span style='color:#0000ff; '>+</span> sHeadInfo<span style='color:#0000ff; '>.</span>length<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>-</span><span style='color:#800000; '>1</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        sResponseInfo <span style='color:#0000ff; '>=</span> sResponseInfo<span style='color:#0000ff; '>.</span>substr<span style='color:#0000ff; '>(</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> sResponseInfo<span style='color:#0000ff; '>.</span><span style='color:#0000ff; font-weight:bold; '>find</span><span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>\n</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> sResponseInfo<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetLastModifiedTime()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets response header modified time</span>
<span style='color:#008000; '>// ==========================================================================</span>

std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> HTTP<span style='color:#0000ff; '>::</span>GetLastModifiedTime<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>string</span> sLastModifiedTime <span style='color:#0000ff; '>=</span> GetResponseHeaderInfo<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Last-Modified</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>sLastModifiedTime<span style='color:#0000ff; '>.</span>empty<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        sLastModifiedTime <span style='color:#0000ff; '>=</span> GetResponseHeaderInfo<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Date</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> sLastModifiedTime<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ThreadHTTPRequestTimeOut()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: HTTP request made in a threaded execution</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>BOOL</span> <span style='color:#0000ff; font-weight:bold; '>WINAPI</span> HTTP<span style='color:#0000ff; '>::</span>ThreadHTTPRequestTimeOut<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwPort <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwSize <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    bHTTPSuccess <span style='color:#0000ff; '>=</span> FALSE<span style='color:#0000ff; '>;</span>  

    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szProtocol<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szAddress<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span>  <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>  
    <span style='color:#0000ff; font-weight:bold; '>TCHAR</span> szURI<span style='color:#0000ff; '>[</span>__SIZE_BUFFER<span style='color:#0000ff; '>]</span>      <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>

    ParseURL<span style='color:#0000ff; '>(</span>szURL<span style='color:#0000ff; '>,</span> szProtocol<span style='color:#0000ff; '>,</span> szAddress<span style='color:#0000ff; '>,</span> dwPort<span style='color:#0000ff; '>,</span> szURI<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>Connect<span style='color:#0000ff; '>(</span>szAddress<span style='color:#0000ff; '>,</span> szAgent<span style='color:#0000ff; '>,</span> dwPort<span style='color:#0000ff; '>,</span> szHTTPUser<span style='color:#0000ff; '>,</span> szHTTPPass<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>RequestOfURI<span style='color:#0000ff; '>(</span>szURI<span style='color:#0000ff; '>,</span> nMethod<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>Response<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span>_szHTTPResponseHeader<span style='color:#0000ff; '>,</span> __SIZE_HTTP_BUFFER<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>PBYTE</span><span style='color:#0000ff; '>)</span>_szHTTPResponseHTML<span style='color:#0000ff; '>,</span> __SIZE_HTTP_BUFFER<span style='color:#0000ff; '>,</span> dwSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
                bHTTPSuccess <span style='color:#0000ff; '>=</span> TRUE<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
        Close<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>ExitThread</span><span style='color:#0000ff; '>(</span>lpThreadExitCode<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> bHTTPSuccess<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ThreadStart()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Start the HTTP request in a thread</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> HTTP<span style='color:#0000ff; '>::</span>ThreadStart<span style='color:#0000ff; '>(</span>HTTP<span style='color:#0000ff; '>*</span> pHTTP<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    pHTTP<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ThreadHTTPRequestTimeOut<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>
</pre>