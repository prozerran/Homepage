<pre style='color:#000000;background:#f1f0f0;'>// ==========================================================================
// Author:  Yee Hsu
// Date:    <span style='color:#8c0000; '>8</span>/<span style='color:#8c0000; '>5</span>/<span style='color:#8c0000; '>2003</span>
// ==========================================================================

<span style='color:#5f5035; background:#ffffe8; '>&lt;?php</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;MIME Class:</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;Allows creation of e-mail messages via the MIME Standard.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;The class supports multiple attachments and presenting </span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;an e-mail in HTML.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>include</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"MIME.def"</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>class</span><span style='color:#000000; background:#ffffe8; '> MIME_mail </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>//public:</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$to</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$from</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$subject</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$body</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$errstr</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// these are the names of the encoding functions, user</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// provide the names of user-defined functions</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$base64_func</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>         </span><span style='color:#c34e00; background:#ffffe8; '># if !specified use PHP's base64  </span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$qp_func</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>            </span><span style='color:#c34e00; background:#ffffe8; '># None at this time</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// If do not have a local mailer..use this array to pass info of an SMTP object</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// e.g. $mime_mail->mailer = array('name' => 'smtp', method => 'smtp_send()');</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// 'name' is the name of the object less the $ and 'method' can have parameters</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// specific to itself.  If you are using MIME_mail object's to, from, etc.</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// remember to send parameters a literal strings referring 'this' object</span><span style='color:#ffffff; background:#808000; '>!!!!</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// If in doubt, you are probably better off subclassing this class...</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$mailer</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>     </span><span style='color:#c34e00; background:#ffffe8; '># Set this to the name of a valid mail object</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>//private:</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>var</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$mimeparts</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>array</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// Constructor.</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> MIME_mail</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$from</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$to</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$subject</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$body</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>to</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$to</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>from</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$from</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$subject</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>body</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$body</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>is_array</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>sizeof</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#c00000; background:#ffffe8; '>1</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>join</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>else</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$from</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>preg_replace</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#800000; background:#ffffe8; '>!</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>from:</span><span style='color:#0f6900; background:#ffffe8; '>\ </span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>+</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#0f6900; background:#ffffe8; '>\r</span><span style='color:#0f6900; background:#ffffe8; '>\n</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#0f6900; background:#ffffe8; '>\b</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#800000; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>i</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>headers</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>chop</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>       </span><span style='color:#c34e00; background:#ffffe8; '>//Bump up location 0;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Attach a 'file' to e-mail message</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Pass a file name to attach.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;This function returns a success/failure code/key of current</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;attachment in array (+1). Read attach() below.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> fattach</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$path</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> OCTET</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> BASE64</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$disp</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>file_exists</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$path</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"File does not exist"</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// Read in file</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$fp</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>fopen</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$path</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"rb"</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>       </span><span style='color:#c34e00; background:#ffffe8; '># (b)inary for Win compatability</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#000000; background:#ffffe8; '>$fp</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"fopen() failed"</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>       </span><span style='color:#c34e00; background:#ffffe8; '>//failed</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>";</span><span style='color:#0f6900; background:#ffffe8; '>\r</span><span style='color:#0f6900; background:#ffffe8; '>\n</span><span style='color:#0f6900; background:#ffffe8; '>\t</span><span style='color:#e60000; background:#ffffe8; '>name="</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>basename</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$path</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>fread</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$fp</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>filesize</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$path</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>attach</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$disp</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Attach data provided by user (rather than a file)</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Useful when you want to MIME encode user input</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;like HTML. NOTE: This function returns key at which the requested</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;data is attached. IT IS CURRENT KEY VALUE + 1</span><span style='color:#ffffff; background:#808000; '>!!</span><span style='color:#c34e00; background:#ffffe8; '></span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Construct the body with MIME parts</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>attach</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> OCTET</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> BASE64</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$disp</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"No data to be attached"</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>trim</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> OCTET </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>trim</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>''</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> BASE64</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> BIT7</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>elseif</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> QP</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$$this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '>qp_func</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>elseif</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> BASE64</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>base64_func</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '>        </span><span style='color:#c34e00; background:#ffffe8; '># Check if there is user-defined function</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>base64_encode</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>else</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$$this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '>base64_func</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$data</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>chunk_split</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>//Check if content-type is text/plain and if charset is not specified append default CHARSET</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>preg_match</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"!^"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>TEXT</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>"!i"</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>preg_match</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#800000; background:#ffffe8; '>!</span><span style='color:#e60000; background:#ffffe8; '>;charset=</span><span style='color:#800000; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>i</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>";</span><span style='color:#0f6900; background:#ffffe8; '>\r</span><span style='color:#0f6900; background:#ffffe8; '>\n</span><span style='color:#0f6900; background:#ffffe8; '>\t</span><span style='color:#e60000; background:#ffffe8; '>charset="</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CHARSET </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>sprintf</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"Content-Type: </span><span style='color:#007997; background:#ffffe8; '>%s</span><span style='color:#e60000; background:#ffffe8; '>Content-Transfer-Encoding: </span><span style='color:#007997; background:#ffffe8; '>%s</span><span style='color:#007997; background:#ffffe8; '>%s</span><span style='color:#007997; background:#ffffe8; '>%s</span><span style='color:#007997; background:#ffffe8; '>%s</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$contenttype</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$encoding</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>BODY </span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#e60000; background:#ffffe8; '>"Content-Description: </span><span style='color:#e60000; background:#ffffe8; '>$description</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e34adc; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$disp</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#e60000; background:#ffffe8; '>"Content-Disposition: </span><span style='color:#e60000; background:#ffffe8; '>$disp</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e34adc; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$emsg</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;BODY</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '>$description</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>sizeof</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;private:</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Construct mail message header from info already given.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;This is a very important function.  It shows how exactly</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;the MIME message is constructed.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> build_message</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$boundary</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'PM'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>chr</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>rand</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#c00000; background:#ffffe8; '>65</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>91</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>'------'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>md5</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>uniqid</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>rand</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>        </span><span style='color:#c34e00; background:#ffffe8; '># Boundary marker</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$nparts</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>sizeof</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// Case 1: Attachment list is there.  Therefore MIME Message header must have multipart/mixed</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>is_array</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$nparts</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>1</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$c_ver</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"MIME-Version: 1.0"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$c_type</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'Content-Type: multipart/mixed;'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#0f6900; background:#ffffe8; '>\t</span><span style='color:#e60000; background:#ffffe8; '>boundary=</span><span style='color:#0f6900; background:#ffffe8; '>\"</span><span style='color:#e60000; background:#ffffe8; '>$boundary</span><span style='color:#0f6900; background:#ffffe8; '>\"</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$c_enc</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"Content-Transfer-Encoding: "</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>BIT7</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$c_desc</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$c_desc</span><span style='color:#806030; background:#ffffe8; '>?</span><span style='color:#e60000; background:#ffffe8; '>"Content-Description: </span><span style='color:#e60000; background:#ffffe8; '>$c_desc</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e34adc; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$warning</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>WARNING</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// Since we are here, it means we do have attachments => body must become an attachment too.</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>body</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>attach</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>body</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> BODY</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> TEXT</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> BIT7</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>// Now create the MIME parts of the email!</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>for</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$i</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$i</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&lt;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$nparts</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$i</span><span style='color:#806030; background:#ffffe8; '>+</span><span style='color:#806030; background:#ffffe8; '>+</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#000000; background:#ffffe8; '>$i</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>'--'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$boundary</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mimeparts</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#000000; background:#ffffe8; '>$i</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'--'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$boundary</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>'--'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$c_ver</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$c_type</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$c_enc</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$c_desc</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$warning</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>else</span><span style='color:#806030; background:#ffffe8; '>:</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>body</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>body</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>endif</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$msg</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;public:</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Now Generate the entire Mail Message, header and body et al.</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> gen_email</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#0f4d75; background:#ffffe8; '>false</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>email</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '>  </span><span style='color:#c34e00; background:#ffffe8; '>// saves processing</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> NOSUBJECT</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>from</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'From: '</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>from</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>headers</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>headers</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '>build_message</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>email</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;public:</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Printable form</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> print_mail</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#0f4d75; background:#ffffe8; '>false</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '>  </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '>gen_email</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>to</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'To: '</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>to</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#806030; background:#ffffe8; '>!</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>'Subject: '</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>CRLF</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>print</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#c34e00; background:#ffffe8; '>/* ---------------------------------------------------------</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;public:</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;&#xa0;Send mail via local mailer</span>
<span style='color:#c34e00; background:#ffffe8; '>&#xa0;--------------------------------------------------------- */</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>function</span><span style='color:#000000; background:#ffffe8; '> send_mail</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#0f4d75; background:#ffffe8; '>false</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-</span><span style='color:#806030; background:#ffffe8; '>></span><span style='color:#000000; background:#ffffe8; '>gen_email</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$force</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>to</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"To Address not specified"</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>is_array</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mailer</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#806030; background:#ffffe8; '>&amp;</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#c00000; background:#ffffe8; '>1</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '>  </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>sizeof</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mailer</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$mail_obj</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mailer</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#e60000; background:#ffffe8; '>'name'</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$mail_method</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>mailer</span><span style='color:#806030; background:#ffffe8; '>[</span><span style='color:#e60000; background:#ffffe8; '>'method'</span><span style='color:#806030; background:#ffffe8; '>]</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>if</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>empty</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$mail_obj</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>{</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>errstr</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#806030; background:#ffffe8; '>=</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>"Invalid object name passed to send_mail()"</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c00000; background:#ffffe8; '>0</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>global</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$mail_obj</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>eval</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#e60000; background:#ffffe8; '>$ret</span><span style='color:#e60000; background:#ffffe8; '> = </span><span style='color:#0f6900; background:#ffffe8; '>\$</span><span style='color:#e60000; background:#ffffe8; '>$mail_obj</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>'->'</span><span style='color:#806030; background:#ffffe8; '>.</span><span style='color:#e60000; background:#ffffe8; '>"</span><span style='color:#e60000; background:#ffffe8; '>$mail_method</span><span style='color:#e60000; background:#ffffe8; '>;"</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$ret</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '>       </span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;&#xa0;</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>return</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#800000; background:#ffffe8; font-weight:bold; '>mail</span><span style='color:#806030; background:#ffffe8; '>(</span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>to</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$</span><span style='color:#400000; background:#ffffe8; font-weight:bold; '>this</span><span style='color:#806030; background:#ffffe8; '>-></span><span style='color:#000000; background:#ffffe8; '>subject</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#e60000; background:#ffffe8; '>""</span><span style='color:#806030; background:#ffffe8; '>,</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#000000; background:#ffffe8; '>$email</span><span style='color:#806030; background:#ffffe8; '>)</span><span style='color:#806030; background:#ffffe8; '>;</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#000000; background:#ffffe8; '>&#xa0;</span><span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '></span>
<span style='color:#806030; background:#ffffe8; '>}</span><span style='color:#000000; background:#ffffe8; '> </span><span style='color:#c34e00; background:#ffffe8; '>// Class End</span><span style='color:#000000; background:#ffffe8; '></span>
</pre>