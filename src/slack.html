<pre style='color:#000020;background:#f6f8ff;'><span style='color:#200080; font-weight:bold; '>using</span> System<span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>using</span> System<span style='color:#308080; '>.</span>Threading<span style='color:#308080; '>.</span>Tasks<span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>using</span> SlackAPI<span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>using</span> System<span style='color:#308080; '>.</span>Linq<span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>namespace</span> CommonLib
<span style='color:#406080; '>{</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>class</span> SlackPoster <span style='color:#308080; '>:</span> ISlackPoster
    <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>string</span> SlackToken <span style='color:#406080; '>{</span> <span style='color:#200080; font-weight:bold; '>get</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>set</span><span style='color:#406080; '>;</span> <span style='color:#406080; '>}</span>
        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>string</span> UpChannel <span style='color:#406080; '>{</span> <span style='color:#200080; font-weight:bold; '>get</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>set</span><span style='color:#406080; '>;</span> <span style='color:#406080; '>}</span>
        <span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#200080; font-weight:bold; '>readonly</span> SlackTaskClient taskClient<span style='color:#406080; '>;</span>

        <span style='color:#200080; font-weight:bold; '>public</span> SlackPoster<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            SlackToken <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
            UpChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>general</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
            taskClient <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> SlackTaskClient<span style='color:#308080; '>(</span>SlackToken<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> SlackPoster<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span> token<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> channel<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            SlackToken <span style='color:#308080; '>=</span> token<span style='color:#406080; '>;</span>
            UpChannel <span style='color:#308080; '>=</span> channel<span style='color:#406080; '>;</span>
            taskClient <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> SlackTaskClient<span style='color:#308080; '>(</span>SlackToken<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>string</span> GetToken<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>return</span> SlackToken<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>string</span> GetChannel<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>return</span> UpChannel<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>
        <span style='color:#200080; font-weight:bold; '>public</span> async Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> PostMessageAsync<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span> message<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span><span style='color:#308080; '>.</span>IsNullOrEmpty<span style='color:#308080; '>(</span>upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                upChannel <span style='color:#308080; '>=</span> UpChannel<span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>var</span> response <span style='color:#308080; '>=</span> await taskClient<span style='color:#308080; '>.</span>PostMessageAsync<span style='color:#308080; '>(</span>upChannel<span style='color:#308080; '>,</span> message<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>return</span> response<span style='color:#308080; '>.</span>ok<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>bool</span> PostMessage<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span> message<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> task <span style='color:#308080; '>=</span> Task<span style='color:#308080; '>.</span>Run<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span>async <span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> await PostMessageAsync<span style='color:#308080; '>(</span>message<span style='color:#308080; '>,</span> upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>return</span> task<span style='color:#308080; '>.</span>Result<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>bool</span> PostMessage<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> messages<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> success <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>[</span>messages<span style='color:#308080; '>.</span>Length<span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>int</span> i <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span> i <span style='color:#308080; '>&lt;</span> messages<span style='color:#308080; '>.</span>Length<span style='color:#406080; '>;</span> i<span style='color:#308080; '>+</span><span style='color:#308080; '>+</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> task <span style='color:#308080; '>=</span> Task<span style='color:#308080; '>.</span>Run<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span>async <span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> await PostMessageAsync<span style='color:#308080; '>(</span>messages<span style='color:#308080; '>[</span>i<span style='color:#308080; '>]</span><span style='color:#308080; '>,</span> upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                success<span style='color:#308080; '>[</span>i<span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> task<span style='color:#308080; '>.</span>Result<span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>success<span style='color:#308080; '>.</span>Contains<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>false</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#200080; font-weight:bold; '>false</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#200080; font-weight:bold; '>true</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> async Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> PostFileAsync<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span> filepath<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> filename<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span><span style='color:#308080; '>.</span>IsNullOrEmpty<span style='color:#308080; '>(</span>upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                upChannel <span style='color:#308080; '>=</span> UpChannel<span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>

            <span style='color:#200080; font-weight:bold; '>byte</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> fileContent <span style='color:#308080; '>=</span> System<span style='color:#308080; '>.</span>IO<span style='color:#308080; '>.</span>File<span style='color:#308080; '>.</span>ReadAllBytes<span style='color:#308080; '>(</span>filepath<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

            <span style='color:#200080; font-weight:bold; '>var</span> response <span style='color:#308080; '>=</span> await taskClient<span style='color:#308080; '>.</span>UploadFileAsync<span style='color:#308080; '>(</span>fileContent<span style='color:#308080; '>,</span> filename<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>new</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> <span style='color:#406080; '>{</span> upChannel <span style='color:#406080; '>}</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>return</span> response<span style='color:#308080; '>.</span>ok<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>bool</span> PostFile<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span> filepath<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> filename<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> task <span style='color:#308080; '>=</span> Task<span style='color:#308080; '>.</span>Run<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span>async <span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> await PostFileAsync<span style='color:#308080; '>(</span>filepath<span style='color:#308080; '>,</span> filename<span style='color:#308080; '>,</span> upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>return</span> task<span style='color:#308080; '>.</span>Result<span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>
        <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>bool</span> PostFile<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>string</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> filepaths<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> filenames<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>string</span> upChannel <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>filepaths<span style='color:#308080; '>.</span>Length <span style='color:#308080; '>!</span><span style='color:#308080; '>=</span> filenames<span style='color:#308080; '>.</span>Length<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#200080; font-weight:bold; '>false</span><span style='color:#406080; '>;</span>

            <span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> success <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>[</span>filepaths<span style='color:#308080; '>.</span>Length<span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>int</span> i <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span> i <span style='color:#308080; '>&lt;</span> filenames<span style='color:#308080; '>.</span>Length<span style='color:#406080; '>;</span> i<span style='color:#308080; '>+</span><span style='color:#308080; '>+</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                Task<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span> task <span style='color:#308080; '>=</span> Task<span style='color:#308080; '>.</span>Run<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>bool</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span>async <span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> await PostFileAsync<span style='color:#308080; '>(</span>filepaths<span style='color:#308080; '>[</span>i<span style='color:#308080; '>]</span><span style='color:#308080; '>,</span> filenames<span style='color:#308080; '>[</span>i<span style='color:#308080; '>]</span><span style='color:#308080; '>,</span> upChannel<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                success<span style='color:#308080; '>[</span>i<span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> task<span style='color:#308080; '>.</span>Result<span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>success<span style='color:#308080; '>.</span>Contains<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>false</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#200080; font-weight:bold; '>false</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#200080; font-weight:bold; '>true</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>
    <span style='color:#406080; '>}</span>
<span style='color:#406080; '>}</span>
</pre>
<!--Created using ToHtml.com on 2022-12-03 07:15:15 UTC -->