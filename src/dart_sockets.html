<pre style='color:#000020;background:#f6f8ff;'>
<span style='color:#200080; font-weight:bold; '>import</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>dart:core</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>dart:io</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>dart:typed_data</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>marketdatamodels.dart</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>class</span> MarketData
    <span style='color:#406080; '>{</span>
        <span style='color:#007d45; '>String</span> host <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>192.168.123.136</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
        int port <span style='color:#308080; '>=</span> <span style='color:#008c00; '>8093</span><span style='color:#406080; '>;</span>

        bool RouterRunning <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>false</span><span style='color:#406080; '>;</span>
        bool IsLoggedIn <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>false</span><span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> UserId<span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> ServerKey<span style='color:#406080; '>;</span>

        Socket socket <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>null</span><span style='color:#406080; '>;</span>

        int AppId <span style='color:#308080; '>=</span> <span style='color:#008c00; '>3</span><span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> VersionNo <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>8.7</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> ReleaseNo <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>1.0</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> BuildNo <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>1.0</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
        <span style='color:#007d45; '>String</span> SystemId <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#1060b6; '>SP_F</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>
        int LangNo <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span>

        <span style='color:#200080; font-weight:bold; '>void</span> <span style='color:#007d45; '>Function</span><span style='color:#308080; '>(</span>TickerResponse<span style='color:#308080; '>)</span> OnTickerResp <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>null</span><span style='color:#406080; '>;</span>
        <span style='color:#200080; font-weight:bold; '>void</span> <span style='color:#007d45; '>Function</span><span style='color:#308080; '>(</span>PriceResponse<span style='color:#308080; '>)</span> OnPriceResp <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>null</span><span style='color:#406080; '>;</span>        

        MarketData<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> userId<span style='color:#308080; '>,</span> <span style='color:#007d45; '>String</span> spKey<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            UserId <span style='color:#308080; '>=</span> userId<span style='color:#406080; '>;</span>
            ServerKey <span style='color:#308080; '>=</span> spKey<span style='color:#406080; '>;</span>
            Start<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> Start<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            Reconnect<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> Reconnect<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> async
        <span style='color:#406080; '>{</span>
            socket <span style='color:#308080; '>=</span> await Socket<span style='color:#308080; '>.</span>connect<span style='color:#308080; '>(</span>host<span style='color:#308080; '>,</span> port<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            print<span style='color:#308080; '>(</span><span style='color:#800000; '>'</span><span style='color:#1060b6; '>Connected to: ${socket.remoteAddress.address}:${socket.remotePort}</span><span style='color:#800000; '>'</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

            <span style='color:#595979; '>// listen for responses from the server</span>
            socket<span style='color:#308080; '>.</span>listen<span style='color:#308080; '>(</span>

              <span style='color:#595979; '>// handle data from the server</span>
              <span style='color:#308080; '>(</span>Uint8List data<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
                  final serverResponse <span style='color:#308080; '>=</span> <span style='color:#007d45; '>String</span><span style='color:#308080; '>.</span>fromCharCodes<span style='color:#308080; '>(</span>data<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                  <span style='color:#595979; '>//print('RECV: $serverResponse');</span>
                  ProcessRecv<span style='color:#308080; '>(</span>serverResponse<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
              <span style='color:#406080; '>}</span><span style='color:#308080; '>,</span>

              <span style='color:#595979; '>// handle errors</span>
              onError<span style='color:#406080; '>:</span> <span style='color:#308080; '>(</span>error<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
                  print<span style='color:#308080; '>(</span>error<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                  socket<span style='color:#308080; '>.</span>destroy<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
              <span style='color:#406080; '>}</span><span style='color:#308080; '>,</span>

              <span style='color:#595979; '>// handle server ending connection</span>
              onDone<span style='color:#406080; '>:</span> <span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
                  print<span style='color:#308080; '>(</span><span style='color:#800000; '>'</span><span style='color:#1060b6; '>Server Disconnected.</span><span style='color:#800000; '>'</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                  socket<span style='color:#308080; '>.</span>destroy<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
              <span style='color:#406080; '>}</span><span style='color:#308080; '>,</span>
            <span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

            RouterRunning <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>true</span><span style='color:#406080; '>;</span>

            Login<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> Login<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> async
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>var</span> LoginTime <span style='color:#308080; '>=</span> DateTime<span style='color:#308080; '>.</span>now<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>millisecondsSinceEpoch<span style='color:#406080; '>;</span>
            <span style='color:#200080; font-weight:bold; '>var</span> strMsg <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>4104,0,$UserId,$ServerKey,$AppId,$VersionNo,$ReleaseNo,$BuildNo,$SystemId,$LoginTime,$LangNo</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
            await SendMessage<span style='color:#308080; '>(</span>strMsg<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>          
        <span style='color:#406080; '>}</span>

        Future<span style='color:#308080; '>&lt;</span><span style='color:#200080; font-weight:bold; '>void</span><span style='color:#308080; '>></span> SendMessage<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> message<span style='color:#308080; '>)</span> async 
        <span style='color:#406080; '>{</span> 
            <span style='color:#595979; '>//if (RouterRunning)</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#595979; '>//print('SEND: $message');</span>
                socket<span style='color:#308080; '>.</span>write<span style='color:#308080; '>(</span>message<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                await Future<span style='color:#308080; '>.</span>delayed<span style='color:#308080; '>(</span>Duration<span style='color:#308080; '>(</span>milliseconds<span style='color:#406080; '>:</span> <span style='color:#008c00; '>50</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> ProcessRecv<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> str<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>str<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>startsWith</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>4104</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>str<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>endsWith</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>0</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
                <span style='color:#406080; '>{</span>
                    IsLoggedIn <span style='color:#308080; '>=</span> <span style='color:#0f4d75; '>true</span><span style='color:#406080; '>;</span>
                <span style='color:#406080; '>}</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>str<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>startsWith</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>4102</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#200080; font-weight:bold; '>var</span> res <span style='color:#308080; '>=</span> DecodePriceProtocol<span style='color:#308080; '>(</span>str<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>OnPriceResp <span style='color:#308080; '>!=</span> <span style='color:#0f4d75; '>null</span><span style='color:#308080; '>)</span> OnPriceResp<span style='color:#308080; '>(</span>res<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>str<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>startsWith</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>4111</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#200080; font-weight:bold; '>var</span> res <span style='color:#308080; '>=</span> DecodeTickerProtocol<span style='color:#308080; '>(</span>str<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>OnTickerResp <span style='color:#308080; '>!=</span> <span style='color:#0f4d75; '>null</span><span style='color:#308080; '>)</span> OnTickerResp<span style='color:#308080; '>(</span>res<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
            <span style='color:#406080; '>}</span>
        <span style='color:#406080; '>}</span>

        PriceResponse DecodePriceProtocol<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prot<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>try</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#200080; font-weight:bold; '>var</span> pr <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> PriceResponse<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                <span style='color:#200080; font-weight:bold; '>var</span> ss <span style='color:#308080; '>=</span> prot<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>split</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>,</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>ss<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>length</span> <span style='color:#308080; '>>=</span> <span style='color:#008c00; '>58</span><span style='color:#308080; '>)</span>
                <span style='color:#406080; '>{</span>
                    pr<span style='color:#308080; '>.</span>prodCode <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>productName <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>productType <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>contractSize <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>5</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>expiryDate <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>6</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>instrumentCode <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>7</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>currency <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>8</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>strike</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>9</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>callPut <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>underlying <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>11</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>bidPrice <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>bidPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>12</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>13</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>14</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>15</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>16</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>17</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>18</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>19</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>20</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>bidQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>21</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>askPrice <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>askPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>22</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>23</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>24</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>25</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>26</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>27</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>28</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>29</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>30</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>askQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>31</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>lastPrice <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty <span style='color:#308080; '>=</span> <span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>lastPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>32</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>33</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>34</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>35</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>36</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>37</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>38</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>39</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastPrice<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>40</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>lastQty<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span> <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>41</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>openInterest <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>42</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>turnoverAmount <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>43</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>turnoverVolume <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>44</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#595979; '>//pr.reserved1 = double.parse(ss[45]);</span>
                    <span style='color:#595979; '>//pr.reserved2 = double.parse(ss[46]);</span>
                    pr<span style='color:#308080; '>.</span>equilibriumPrice <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>47</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>open <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>48</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>high <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>49</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>low <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>50</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>previousClose <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>51</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>previousCloseDate <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>52</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#595979; '>//pr.notUsed = double.parse(ss[53]);</span>
                    pr<span style='color:#308080; '>.</span>tradeStateNo <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>54</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                    pr<span style='color:#308080; '>.</span>lotSize <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>55</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>tickSize <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>56</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    pr<span style='color:#308080; '>.</span>updateTime <span style='color:#308080; '>=</span> DateTime<span style='color:#308080; '>.</span>now<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>millisecondsSinceEpoch<span style='color:#406080; '>;</span>

                    <span style='color:#595979; '>// ignore everything after newline</span>
                    int posNL <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>57</span><span style='color:#308080; '>]</span><span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>indexOf</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>posNL <span style='color:#308080; '>>=</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span>
                    <span style='color:#406080; '>{</span>
                        <span style='color:#200080; font-weight:bold; '>var</span> dt <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>57</span><span style='color:#308080; '>]</span><span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>substring</span><span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> posNL<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                        pr<span style='color:#308080; '>.</span>updateTime <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>dt<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#406080; '>}</span>
                    <span style='color:#200080; font-weight:bold; '>return</span> pr<span style='color:#406080; '>;</span>
                <span style='color:#406080; '>}</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>catch</span><span style='color:#308080; '>(</span>e<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span> <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#0f4d75; '>null</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        TickerResponse DecodeTickerProtocol<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prot<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>try</span>
            <span style='color:#406080; '>{</span>
                <span style='color:#200080; font-weight:bold; '>var</span> tr <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> TickerResponse<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                <span style='color:#200080; font-weight:bold; '>var</span> ss <span style='color:#308080; '>=</span> prot<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>split</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#1060b6; '>,</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

                <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>ss<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>length</span> <span style='color:#308080; '>>=</span> <span style='color:#008c00; '>11</span><span style='color:#308080; '>)</span>
                <span style='color:#406080; '>{</span>
                    tr<span style='color:#308080; '>.</span>tickerTime <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>prodCode <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>price <span style='color:#308080; '>=</span> double<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>qty <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>5</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>dealSrc <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>6</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>              
                    tr<span style='color:#308080; '>.</span>hitSide <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>8</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>buySideBroker <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>9</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
                    tr<span style='color:#308080; '>.</span>sellSideBroker <span style='color:#308080; '>=</span> <span style='color:#800000; '>"</span><span style='color:#800000; '>"</span><span style='color:#406080; '>;</span>

                    <span style='color:#595979; '>// adjust price if decInPrc > 0</span>
                    <span style='color:#200080; font-weight:bold; '>var</span> dec <span style='color:#308080; '>=</span> int<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>parse</span><span style='color:#308080; '>(</span>ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>7</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>dec <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span>
                    <span style='color:#406080; '>{</span>
                        <span style='color:#200080; font-weight:bold; '>var</span> mul <span style='color:#308080; '>=</span> <span style='color:#008c00; '>10</span> <span style='color:#308080; '>*</span> dec<span style='color:#406080; '>;</span>
                        <span style='color:#200080; font-weight:bold; '>var</span> prc <span style='color:#308080; '>=</span> tr<span style='color:#308080; '>.</span>price <span style='color:#308080; '>/</span> mul<span style='color:#406080; '>;</span>
                        tr<span style='color:#308080; '>.</span>price <span style='color:#308080; '>=</span> prc<span style='color:#406080; '>;</span>
                    <span style='color:#406080; '>}</span>

                    <span style='color:#595979; '>// ignore everything after newline</span>
                    int posNL <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>]</span><span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>indexOf</span><span style='color:#308080; '>(</span><span style='color:#800000; '>"</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>posNL <span style='color:#308080; '>>=</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span>
                    <span style='color:#406080; '>{</span>
                        tr<span style='color:#308080; '>.</span>sellSideBroker <span style='color:#308080; '>=</span> ss<span style='color:#308080; '>[</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>]</span><span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>substring</span><span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> posNL<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
                    <span style='color:#406080; '>}</span>
                    <span style='color:#200080; font-weight:bold; '>return</span> tr<span style='color:#406080; '>;</span>
                <span style='color:#406080; '>}</span>
            <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>catch</span><span style='color:#308080; '>(</span>e<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span> <span style='color:#406080; '>}</span>
            <span style='color:#200080; font-weight:bold; '>return</span> <span style='color:#0f4d75; '>null</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> SubcribePrice<span style='color:#308080; '>(</span>List<span style='color:#308080; '>&lt;</span><span style='color:#007d45; '>String</span><span style='color:#308080; '>></span> prods<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            prods<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>forEach</span><span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> _SubcribePrice<span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> _SubcribePrice<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prod<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>var</span> strMsg <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>4107,0,$prod,0,1,0</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
            SendMessage<span style='color:#308080; '>(</span>strMsg<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> UnSubscribePrice<span style='color:#308080; '>(</span>List<span style='color:#308080; '>&lt;</span><span style='color:#007d45; '>String</span><span style='color:#308080; '>></span> prods<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            prods<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>forEach</span><span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> _UnSubscribePrice<span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> _UnSubscribePrice<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prod<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>var</span> strMsg <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>4108,0,$prod,0,0</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
            SendMessage<span style='color:#308080; '>(</span>strMsg<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> SubcribeTicker<span style='color:#308080; '>(</span>List<span style='color:#308080; '>&lt;</span><span style='color:#007d45; '>String</span><span style='color:#308080; '>></span> prods<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            prods<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>forEach</span><span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> _SubcribeTicker<span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> _SubcribeTicker<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prod<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>var</span> strMsg <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>4107,0,$prod,0,1,2</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
            SendMessage<span style='color:#308080; '>(</span>strMsg<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> UnSubscribeTicker<span style='color:#308080; '>(</span>List<span style='color:#308080; '>&lt;</span><span style='color:#007d45; '>String</span><span style='color:#308080; '>></span> prods<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            prods<span style='color:#308080; '>.</span><span style='color:#200080; font-weight:bold; '>forEach</span><span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>></span> _UnSubscribeTicker<span style='color:#308080; '>(</span>element<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>

        <span style='color:#200080; font-weight:bold; '>void</span> _UnSubscribeTicker<span style='color:#308080; '>(</span><span style='color:#007d45; '>String</span> prod<span style='color:#308080; '>)</span>
        <span style='color:#406080; '>{</span>
            <span style='color:#200080; font-weight:bold; '>var</span> strMsg <span style='color:#308080; '>=</span> <span style='color:#800000; '>'</span><span style='color:#1060b6; '>4108,0,$prod,0,2</span><span style='color:#0f69ff; '>\r</span><span style='color:#0f69ff; '>\n</span><span style='color:#800000; '>'</span><span style='color:#406080; '>;</span>
            SendMessage<span style='color:#308080; '>(</span>strMsg<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        <span style='color:#406080; '>}</span>
    <span style='color:#406080; '>}</span>
</pre>
<!--Created using ToHtml.com on 2021-07-14 02:22:26 UTC -->