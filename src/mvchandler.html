<pre style='color:#000020;background:#f6f8ff;'>
<span style='color:#200080; font-weight:bold; '>package</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>services</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ArrayList</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Calendar</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Collections</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Comparator</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Date</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>HashMap</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Iterator</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>List</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>util</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Map</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> javax</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>persistence</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>EntityManager</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>lang</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Math</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>math</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>BigInteger</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sql</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Timestamp</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>time</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>LocalDate</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>time</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>LocalDateTime</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>time</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>LocalTime</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> java</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>time</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ZoneId</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>beans</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>factory</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>annotation</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Autowired</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>cache</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>annotation</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>CacheEvict</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>cache</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>annotation</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Cacheable</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>scheduling</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>annotation</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Scheduled</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>stereotype</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Component</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> org</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>springframework</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>stereotype</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>Service</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>app</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>AppConstants</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartInterval</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>app</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>JPAUtility</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>app</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>SPCommon</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>app</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>SPConfig</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>entities</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataDaily</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>entities</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataHour</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>entities</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataMinute</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>entities</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataSecond</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>entities</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataTicker</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>models</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataData</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>models</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataLegacy</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>models</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataObject</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataDailyRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataGenericRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataHourRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataMinuteRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataSecondRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>ChartdataTickerRepository</span><span style='color:#406080; '>;</span>
<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>sp</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>repositories</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>IChartData</span><span style='color:#406080; '>;</span>

<span style='color:#200080; font-weight:bold; '>import</span><span style='color:#004a43; '> com</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>alibaba</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>fastjson</span><span style='color:#308080; '>.</span><span style='color:#004a43; '>JSON</span><span style='color:#406080; '>;</span>

<span style='color:#3f7f8f; '>/**</span>
<span style='color:#3f7f8f; '>&#xa0;</span><span style='color:#7f9fbf; font-weight:bold; '>*</span><span style='color:#3f7f8f; '> Product service implement.</span>
<span style='color:#3f7f8f; '>&#xa0;*/</span>
<span style='color:#7f9fbf; font-weight:bold; '>@Service</span>
<span style='color:#7f9fbf; font-weight:bold; '>@Component</span>
<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#200080; font-weight:bold; '>class</span> ChartdataServiceImpl <span style='color:#200080; font-weight:bold; '>implements</span> ChartdataService <span style='color:#406080; '>{</span>
	
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataSecondRepository cdsr<span style='color:#406080; '>;</span>
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataMinuteRepository cdmr<span style='color:#406080; '>;</span>
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataHourRepository cdhr<span style='color:#406080; '>;</span>
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataDailyRepository cddr<span style='color:#406080; '>;</span>
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataTickerRepository cdtr<span style='color:#406080; '>;</span>
    <span style='color:#200080; font-weight:bold; '>private</span> ChartdataGenericRepository cdgr<span style='color:#406080; '>;</span>
	
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataSecondRepository<span style='color:#308080; '>(</span>ChartdataSecondRepository chartdataSecondRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cdsr <span style='color:#308080; '>=</span> chartdataSecondRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>    
    
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataMinuteRepository<span style='color:#308080; '>(</span>ChartdataMinuteRepository chartdataMinuteRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cdmr <span style='color:#308080; '>=</span> chartdataMinuteRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span> 
    
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataHourlyRepository<span style='color:#308080; '>(</span>ChartdataHourRepository chartdataHourRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cdhr <span style='color:#308080; '>=</span> chartdataHourRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>  
    
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataDailyRepository<span style='color:#308080; '>(</span>ChartdataDailyRepository chartdataDailyRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cddr <span style='color:#308080; '>=</span> chartdataDailyRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>
    
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataTickerRepository<span style='color:#308080; '>(</span>ChartdataTickerRepository chartdataTickerRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cdtr <span style='color:#308080; '>=</span> chartdataTickerRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>  
    
    <span style='color:#7f9fbf; font-weight:bold; '>@Autowired</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartdataTickerRepository<span style='color:#308080; '>(</span>ChartdataGenericRepository chartdataGenericRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
        <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>cdgr <span style='color:#308080; '>=</span> chartdataGenericRepository<span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>  
    
	<span style='color:#7f9fbf; font-weight:bold; '>@Scheduled(fixedRate = 5000)</span>
	<span style='color:#7f9fbf; font-weight:bold; '>@CacheEvict(value = "getChartDataCached", allEntries = true)</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> cacheEvictionEvent<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>throws</span> <span style='color:#6679aa; font-weight:bold; '>Exception</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>//System.out.println("Cache Evicted!");</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> doEvictCache<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#6679aa; font-weight:bold; '>System</span><span style='color:#308080; '>.</span>out<span style='color:#308080; '>.</span>println<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"Evicting all cache!"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		net<span style='color:#308080; '>.</span>sf<span style='color:#308080; '>.</span>ehcache<span style='color:#308080; '>.</span>CacheManager<span style='color:#308080; '>.</span>getInstance<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>clearAll<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span> 	
		
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> getChartDataSecond<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>	
		<span style='color:#200080; font-weight:bold; '>return</span> cdsr<span style='color:#308080; '>.</span>getListChartDataSecond<span style='color:#308080; '>(</span>from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataMinute<span style='color:#308080; '>></span> getChartDataMinute<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>	
		<span style='color:#200080; font-weight:bold; '>return</span> cdmr<span style='color:#308080; '>.</span>getListChartDataMinute<span style='color:#308080; '>(</span>from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataHour<span style='color:#308080; '>></span> getChartDataHour<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>	
		<span style='color:#200080; font-weight:bold; '>return</span> cdhr<span style='color:#308080; '>.</span>getListChartDataHour<span style='color:#308080; '>(</span>from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataDaily<span style='color:#308080; '>></span> getChartDataDaily<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>	
		<span style='color:#200080; font-weight:bold; '>return</span> cddr<span style='color:#308080; '>.</span>getListChartDataDaily<span style='color:#308080; '>(</span>from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>	

	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartDataSecond<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> json_data<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> JSON<span style='color:#308080; '>.</span>parseArray<span style='color:#308080; '>(</span>json_data<span style='color:#308080; '>,</span> ChartdataSecond<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataSecond cds <span style='color:#308080; '>:</span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>					
			cdsr<span style='color:#308080; '>.</span>replaceChartDataWithRecId<span style='color:#308080; '>(</span>cds<span style='color:#308080; '>.</span>getRecId<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getProdCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getPrevClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getInstmntCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>					
		<span style='color:#406080; '>}</span>		
	<span style='color:#406080; '>}</span>	
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartDataMinute<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> json_data<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataMinute<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> JSON<span style='color:#308080; '>.</span>parseArray<span style='color:#308080; '>(</span>json_data<span style='color:#308080; '>,</span> ChartdataMinute<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataMinute cds <span style='color:#308080; '>:</span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>					
			cdmr<span style='color:#308080; '>.</span>replaceChartData<span style='color:#308080; '>(</span>cds<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getProdCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getPrevClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getInstmntCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#406080; '>}</span>		
	<span style='color:#406080; '>}</span>	
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartDataHour<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> json_data<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataHour<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> JSON<span style='color:#308080; '>.</span>parseArray<span style='color:#308080; '>(</span>json_data<span style='color:#308080; '>,</span> ChartdataHour<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataHour cds <span style='color:#308080; '>:</span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>					
			cdhr<span style='color:#308080; '>.</span>replaceChartData<span style='color:#308080; '>(</span>cds<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getProdCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getPrevClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getInstmntCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#406080; '>}</span>		
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> setChartDataDaily<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> json_data<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataDaily<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> JSON<span style='color:#308080; '>.</span>parseArray<span style='color:#308080; '>(</span>json_data<span style='color:#308080; '>,</span> ChartdataDaily<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataDaily cds <span style='color:#308080; '>:</span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>					
			cddr<span style='color:#308080; '>.</span>replaceChartData<span style='color:#308080; '>(</span>cds<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getProdCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getPrevClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span>
					cds<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cds<span style='color:#308080; '>.</span>getInstmntCode<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>					
		<span style='color:#406080; '>}</span>		
	<span style='color:#406080; '>}</span>	
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> putChartDataLegacy<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> json_data<span style='color:#308080; '>,</span> ChartInterval intv<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>		
		<span style='color:#7779bb; '>long</span> rec_id_cnt <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span>
    	IChartData pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span>    	
    	
    	<span style='color:#200080; font-weight:bold; '>switch</span> <span style='color:#308080; '>(</span>intv<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> MINUTE<span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdmr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> HOUR<span style='color:#308080; '>:</span>		pcd <span style='color:#308080; '>=</span> cdhr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> DAILY<span style='color:#308080; '>:</span>		pcd <span style='color:#308080; '>=</span> cddr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>default</span><span style='color:#308080; '>:</span>		pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
    	<span style='color:#406080; '>}</span>			
		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataLegacy<span style='color:#308080; '>></span> lcdl <span style='color:#308080; '>=</span> JSON<span style='color:#308080; '>.</span>parseArray<span style='color:#308080; '>(</span>json_data<span style='color:#308080; '>,</span> ChartdataLegacy<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataLegacy cdl <span style='color:#308080; '>:</span> lcdl<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>			
			<span style='color:#7779bb; '>double</span> open <span style='color:#308080; '>=</span> cdl<span style='color:#308080; '>.</span>open<span style='color:#308080; '>.</span>doubleValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>pow<span style='color:#308080; '>(</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>,</span>  cdl<span style='color:#308080; '>.</span>dec_in_price<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#7779bb; '>double</span> high <span style='color:#308080; '>=</span> cdl<span style='color:#308080; '>.</span>high<span style='color:#308080; '>.</span>doubleValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>pow<span style='color:#308080; '>(</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>,</span>  cdl<span style='color:#308080; '>.</span>dec_in_price<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#7779bb; '>double</span> low <span style='color:#308080; '>=</span> cdl<span style='color:#308080; '>.</span>low<span style='color:#308080; '>.</span>doubleValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>pow<span style='color:#308080; '>(</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>,</span>  cdl<span style='color:#308080; '>.</span>dec_in_price<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#7779bb; '>double</span> close <span style='color:#308080; '>=</span> cdl<span style='color:#308080; '>.</span>close<span style='color:#308080; '>.</span>doubleValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>pow<span style='color:#308080; '>(</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>,</span>  cdl<span style='color:#308080; '>.</span>dec_in_price<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#7779bb; '>double</span> prev_close <span style='color:#308080; '>=</span> cdl<span style='color:#308080; '>.</span>prev_close<span style='color:#308080; '>.</span>doubleValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>pow<span style='color:#308080; '>(</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>,</span>  cdl<span style='color:#308080; '>.</span>dec_in_price<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>intv <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> ChartInterval<span style='color:#308080; '>.</span>SECOND<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>				
				<span style='color:#6679aa; font-weight:bold; '>String</span> rec_id_s <span style='color:#308080; '>=</span> <span style='color:#6679aa; font-weight:bold; '>String</span><span style='color:#308080; '>.</span>format<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"%d%d"</span><span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>log_time<span style='color:#308080; '>,</span> rec_id_cnt<span style='color:#308080; '>+</span><span style='color:#308080; '>+</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				<span style='color:#6679aa; font-weight:bold; '>BigInteger</span> rec_id <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>BigInteger</span><span style='color:#308080; '>(</span>rec_id_s<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				
				<span style='color:#595979; '>//String str = String.format("%s, %d, %d, %d, %d, %s", rec_id_s, open, high, low, close, cdl.prod_code);</span>
				<span style='color:#595979; '>//System.out.println(str);</span>
				
				cdsr<span style='color:#308080; '>.</span>replaceChartDataWithRecId<span style='color:#308080; '>(</span>rec_id<span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>log_time<span style='color:#308080; '>,</span>
						cdl<span style='color:#308080; '>.</span>prod_code<span style='color:#308080; '>,</span> open<span style='color:#308080; '>,</span> high<span style='color:#308080; '>,</span> low<span style='color:#308080; '>,</span> close<span style='color:#308080; '>,</span> prev_close<span style='color:#308080; '>,</span>
						cdl<span style='color:#308080; '>.</span>qty<span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>turnover<span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>instmnt_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#406080; '>}</span> <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#406080; '>{</span>				
				pcd<span style='color:#308080; '>.</span>replaceChartData<span style='color:#308080; '>(</span>cdl<span style='color:#308080; '>.</span>log_time<span style='color:#308080; '>,</span>
						cdl<span style='color:#308080; '>.</span>prod_code<span style='color:#308080; '>,</span> open<span style='color:#308080; '>,</span> high<span style='color:#308080; '>,</span> low<span style='color:#308080; '>,</span> close<span style='color:#308080; '>,</span> prev_close<span style='color:#308080; '>,</span>
						cdl<span style='color:#308080; '>.</span>qty<span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>turnover<span style='color:#308080; '>,</span> cdl<span style='color:#308080; '>.</span>instmnt_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>								
			<span style='color:#406080; '>}</span>						
		<span style='color:#406080; '>}</span>
	<span style='color:#406080; '>}</span>			
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> doHouseClean<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> tablename<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
    	
    	IChartData pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span>    	
    	
    	<span style='color:#200080; font-weight:bold; '>switch</span> <span style='color:#308080; '>(</span> tablename <span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
    		<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"tb.chartdata_ticker"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdtr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>    	
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"tb.chartdata_second"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdsr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"tb.chartdata_minute"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdmr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"tb.chartdata_hour"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdhr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"tb.chartdata_daily"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cddr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>default</span><span style='color:#308080; '>:</span>					pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
    	<span style='color:#406080; '>}</span>    	
    	
	    <span style='color:#6679aa; font-weight:bold; '>String</span> days <span style='color:#308080; '>=</span> SPConfig<span style='color:#308080; '>.</span>getInstance<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetProperty<span style='color:#308080; '>(</span>tablename<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 	           
        <span style='color:#6679aa; font-weight:bold; '>Date</span> date <span style='color:#308080; '>=</span> <span style='color:#6679aa; font-weight:bold; '>Date</span><span style='color:#308080; '>.</span>from<span style='color:#308080; '>(</span>LocalDate<span style='color:#308080; '>.</span>now<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>atStartOfDay<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        		<span style='color:#308080; '>.</span>minusDays<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Long</span><span style='color:#308080; '>.</span>parseLong<span style='color:#308080; '>(</span>days<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        		<span style='color:#308080; '>.</span>atZone<span style='color:#308080; '>(</span>ZoneId<span style='color:#308080; '>.</span>systemDefault<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        		<span style='color:#308080; '>.</span>toInstant<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	    	    
        pcd<span style='color:#308080; '>.</span>purgeDataByDate<span style='color:#308080; '>(</span>date<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
        pcd<span style='color:#308080; '>.</span>optimizeTable<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
        
        SPCommon<span style='color:#308080; '>.</span>ConsoleLog<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"%s purged before: %s"</span><span style='color:#308080; '>,</span> tablename<span style='color:#308080; '>,</span> date<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>   
    <span style='color:#406080; '>}</span>
    
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
    <span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>void</span> consolidateChartDataTables<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> updatetable<span style='color:#308080; '>,</span> LocalDate dt<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Long</span> seconds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
    	
    	IChartData pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span>    	
    	<span style='color:#6679aa; font-weight:bold; '>Date</span> date <span style='color:#308080; '>=</span> <span style='color:#6679aa; font-weight:bold; '>Timestamp</span><span style='color:#308080; '>.</span>valueOf<span style='color:#308080; '>(</span>dt<span style='color:#308080; '>.</span>atStartOfDay<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>     	
    	
    	<span style='color:#200080; font-weight:bold; '>switch</span> <span style='color:#308080; '>(</span>updatetable <span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"ChartdataMinute"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdmr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"ChartdataHour"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cdhr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>case</span> <span style='color:#1060b6; '>"ChartdataDaily"</span><span style='color:#308080; '>:</span>	pcd <span style='color:#308080; '>=</span> cddr<span style='color:#406080; '>;</span>	<span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
	    	<span style='color:#200080; font-weight:bold; '>default</span><span style='color:#308080; '>:</span>				pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span> <span style='color:#200080; font-weight:bold; '>break</span><span style='color:#406080; '>;</span>
    	<span style='color:#406080; '>}</span>
   
    	<span style='color:#595979; '>// delete target rows first    	</span>
    	pcd<span style='color:#308080; '>.</span>deleteDataByDate<span style='color:#308080; '>(</span>date<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
    	
    	<span style='color:#6679aa; font-weight:bold; '>Long</span> sel_sec <span style='color:#308080; '>=</span> seconds<span style='color:#406080; '>;</span>
    	<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>seconds <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> <span style='color:#008c00; '>86400</span><span style='color:#006600; '>L</span><span style='color:#308080; '>)</span>
    		sel_sec <span style='color:#308080; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#006600; '>L</span><span style='color:#406080; '>;</span>    	
    	
    	<span style='color:#595979; '>// get records in ChartDataSecond table</span>
    	<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> cdsr<span style='color:#308080; '>.</span>getListChartDataObject<span style='color:#308080; '>(</span>sel_sec<span style='color:#308080; '>,</span> date<span style='color:#308080; '>,</span> seconds<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataObject<span style='color:#308080; '>></span> lcdo <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span>ChartdataObject<span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>    	    
		<span style='color:#6679aa; font-weight:bold; '>Iterator</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> it <span style='color:#308080; '>=</span> lcds<span style='color:#308080; '>.</span>iterator<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>// massage data</span>
		<span style='color:#200080; font-weight:bold; '>while</span><span style='color:#308080; '>(</span>it<span style='color:#308080; '>.</span>hasNext<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		     <span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> row <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span> it<span style='color:#308080; '>.</span>next<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		     ChartdataObject cdo <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> ChartdataObject<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		     
		     <span style='color:#6679aa; font-weight:bold; '>Integer</span> log_time <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>mkt_datetime <span style='color:#308080; '>=</span> log_time<span style='color:#308080; '>.</span>longValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>prod_code <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>open <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>double</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>high <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>double</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>low <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>double</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>4</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>close <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>double</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>5</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>prev_close <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>double</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>6</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>		     
		     cdo<span style='color:#308080; '>.</span>qty <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>long</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>7</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>		     
		     cdo<span style='color:#308080; '>.</span>log_no_max <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>BigInteger</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>8</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>log_no_min <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>BigInteger</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>9</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>turnover <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>BigInteger</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>10</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>instmnt_code <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>11</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>

		     <span style='color:#595979; '>// override open + close</span>
		     cdo<span style='color:#308080; '>.</span>last_close <span style='color:#308080; '>=</span> cdsr<span style='color:#308080; '>.</span>getChartDataClose<span style='color:#308080; '>(</span>cdo<span style='color:#308080; '>.</span>log_no_max<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		     cdo<span style='color:#308080; '>.</span>first_open <span style='color:#308080; '>=</span> cdsr<span style='color:#308080; '>.</span>getChartDataOpen<span style='color:#308080; '>(</span>cdo<span style='color:#308080; '>.</span>log_no_min<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		     
		     lcdo<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span>cdo<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#406080; '>}</span>  	
		
		<span style='color:#595979; '>// replace into DB</span>
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataObject cdo <span style='color:#308080; '>:</span> lcdo<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>				
			pcd<span style='color:#308080; '>.</span>replaceChartData<span style='color:#308080; '>(</span>cdo<span style='color:#308080; '>.</span>mkt_datetime<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>prod_code<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>first_open<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>high<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>low<span style='color:#308080; '>,</span> 
					cdo<span style='color:#308080; '>.</span>last_close<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>prev_close<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>qty<span style='color:#308080; '>.</span>intValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>turnover<span style='color:#308080; '>,</span> cdo<span style='color:#308080; '>.</span>instmnt_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#406080; '>}</span>		
        SPCommon<span style='color:#308080; '>.</span>ConsoleLog<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"%s consolidated for: %s"</span><span style='color:#308080; '>,</span> updatetable<span style='color:#308080; '>,</span> date<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
    <span style='color:#406080; '>}</span>    
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataTicker<span style='color:#308080; '>></span> getTickerData<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> bars<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>			
		<span style='color:#6679aa; font-weight:bold; '>String</span> sql <span style='color:#308080; '>=</span> <span style='color:#1060b6; '>"SELECT c FROM ChartdataTicker c WHERE c.prod_code = :prodcode ORDER BY c.mkt_datetime DESC"</span><span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>final</span> EntityManager em <span style='color:#308080; '>=</span> JPAUtility<span style='color:#308080; '>.</span>getEntityManager<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataTicker<span style='color:#308080; '>></span> lcdt <span style='color:#308080; '>=</span> em<span style='color:#308080; '>.</span>createQuery<span style='color:#308080; '>(</span>sql<span style='color:#308080; '>,</span> ChartdataTicker<span style='color:#308080; '>.</span>class<span style='color:#308080; '>)</span>
				<span style='color:#308080; '>.</span>setParameter<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"prodcode"</span><span style='color:#308080; '>,</span> prodcode<span style='color:#308080; '>)</span>	
				<span style='color:#308080; '>.</span>setMaxResults<span style='color:#308080; '>(</span>bars<span style='color:#308080; '>)</span>
				<span style='color:#308080; '>.</span>getResultList<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>//em.close();		</span>
		<span style='color:#200080; font-weight:bold; '>return</span> lcdt<span style='color:#406080; '>;</span>			
	<span style='color:#406080; '>}</span>	
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getCutOffTime")</span>			
	<span style='color:#7f9fbf; font-weight:bold; '>@SuppressWarnings("deprecation")</span>
	<span style='color:#200080; font-weight:bold; '>public</span> LocalTime getCutOffTime<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>		
		LocalTime cutoff_time <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span>	
		<span style='color:#6679aa; font-weight:bold; '>String</span> instr_code <span style='color:#308080; '>=</span> cdsr<span style='color:#308080; '>.</span>getInstrumentCode<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>instr_code <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span> <span style='color:#308080; '>|</span><span style='color:#308080; '>|</span> instr_code<span style='color:#308080; '>.</span>isEmpty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
			<span style='color:#200080; font-weight:bold; '>return</span> cutoff_time<span style='color:#406080; '>;</span>
		
		<span style='color:#6679aa; font-weight:bold; '>String</span> mkt_code <span style='color:#308080; '>=</span> cdgr<span style='color:#308080; '>.</span>getMarketCode<span style='color:#308080; '>(</span>instr_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lirc <span style='color:#308080; '>=</span> cdgr<span style='color:#308080; '>.</span>getInstrumentRegionCutoff<span style='color:#308080; '>(</span>instr_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>lirc<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			<span style='color:#6679aa; font-weight:bold; '>Iterator</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> it <span style='color:#308080; '>=</span> lirc<span style='color:#308080; '>.</span>iterator<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>it<span style='color:#308080; '>.</span>hasNext<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			    <span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> row <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span> it<span style='color:#308080; '>.</span>next<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			    
			 	<span style='color:#6679aa; font-weight:bold; '>Timestamp</span> w <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Timestamp</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span> 
				<span style='color:#6679aa; font-weight:bold; '>Timestamp</span> s <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Timestamp</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span> 	
			    <span style='color:#6679aa; font-weight:bold; '>String</span> region_name <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>			   			    
				LocalTime win_time <span style='color:#308080; '>=</span> LocalTime<span style='color:#308080; '>.</span>of<span style='color:#308080; '>(</span>w<span style='color:#308080; '>.</span>getHours<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> w<span style='color:#308080; '>.</span>getMinutes<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> w<span style='color:#308080; '>.</span>getSeconds<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				LocalTime sum_time <span style='color:#308080; '>=</span> LocalTime<span style='color:#308080; '>.</span>of<span style='color:#308080; '>(</span>s<span style='color:#308080; '>.</span>getHours<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> s<span style='color:#308080; '>.</span>getMinutes<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> s<span style='color:#308080; '>.</span>getSeconds<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>							
				<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lrd <span style='color:#308080; '>=</span> cdgr<span style='color:#308080; '>.</span>getRegionDate<span style='color:#308080; '>(</span>region_name<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				
				<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>lrd<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span>
					cutoff_time <span style='color:#308080; '>=</span> sum_time<span style='color:#406080; '>;</span>
				<span style='color:#200080; font-weight:bold; '>else</span>
					cutoff_time <span style='color:#308080; '>=</span> win_time<span style='color:#406080; '>;</span>
			<span style='color:#406080; '>}</span>			
		<span style='color:#406080; '>}</span>
		
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>cutoff_time <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lmrc <span style='color:#308080; '>=</span> cdgr<span style='color:#308080; '>.</span>getMarketRegionCutoff<span style='color:#308080; '>(</span>mkt_code<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
			
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>lmrc<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
				<span style='color:#6679aa; font-weight:bold; '>Iterator</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> it <span style='color:#308080; '>=</span> lmrc<span style='color:#308080; '>.</span>iterator<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
				
				<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>it<span style='color:#308080; '>.</span>hasNext<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
				    <span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span> row <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>)</span> it<span style='color:#308080; '>.</span>next<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
				    
				 	<span style='color:#6679aa; font-weight:bold; '>Timestamp</span> w <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Timestamp</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span> 
					<span style='color:#6679aa; font-weight:bold; '>Timestamp</span> s <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Timestamp</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span> 	
				    <span style='color:#6679aa; font-weight:bold; '>String</span> region_name <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> row<span style='color:#308080; '>[</span><span style='color:#008c00; '>2</span><span style='color:#308080; '>]</span><span style='color:#406080; '>;</span>				    				    				  				   
					LocalTime win_time <span style='color:#308080; '>=</span> LocalTime<span style='color:#308080; '>.</span>of<span style='color:#308080; '>(</span>w<span style='color:#308080; '>.</span>getHours<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> w<span style='color:#308080; '>.</span>getMinutes<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> w<span style='color:#308080; '>.</span>getSeconds<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
					LocalTime sum_time <span style='color:#308080; '>=</span> LocalTime<span style='color:#308080; '>.</span>of<span style='color:#308080; '>(</span>s<span style='color:#308080; '>.</span>getHours<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> s<span style='color:#308080; '>.</span>getMinutes<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> s<span style='color:#308080; '>.</span>getSeconds<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
					
					<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>region_name <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span> <span style='color:#308080; '>|</span><span style='color:#308080; '>|</span> region_name<span style='color:#308080; '>.</span>isEmpty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> 
						cutoff_time <span style='color:#308080; '>=</span> win_time<span style='color:#406080; '>;</span>
					<span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#406080; '>{</span>
						<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lrd <span style='color:#308080; '>=</span> cdgr<span style='color:#308080; '>.</span>getRegionDate<span style='color:#308080; '>(</span>region_name<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
						
						<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>lrd<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>></span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span>
							cutoff_time <span style='color:#308080; '>=</span> sum_time<span style='color:#406080; '>;</span>
						<span style='color:#200080; font-weight:bold; '>else</span>
							cutoff_time <span style='color:#308080; '>=</span> win_time<span style='color:#406080; '>;</span>						
					<span style='color:#406080; '>}</span>				
				<span style='color:#406080; '>}</span>			
			<span style='color:#406080; '>}</span>			
		<span style='color:#406080; '>}</span>
		<span style='color:#200080; font-weight:bold; '>return</span> cutoff_time<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>  	
        	
	<span style='color:#595979; '>//@Cacheable("GetOHLC")		</span>
	<span style='color:#200080; font-weight:bold; '>private</span> ChartdataSecond GetOHLC<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		ChartdataSecond cds <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> ChartdataSecond<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		cds<span style='color:#308080; '>.</span>setMktDatetime<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setOpen<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setClose<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>-</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setPrevClose<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>.</span>size<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>-</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getPrevClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#7779bb; '>double</span> high <span style='color:#308080; '>=</span> lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#7779bb; '>double</span> low <span style='color:#308080; '>=</span> lcds<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		
	  	<span style='color:#6679aa; font-weight:bold; '>BigInteger</span> turnover <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>BigInteger</span><span style='color:#308080; '>(</span><span style='color:#1060b6; '>"0"</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#6679aa; font-weight:bold; '>Integer</span> qty <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span>
		
		<span style='color:#200080; font-weight:bold; '>for</span> <span style='color:#308080; '>(</span>ChartdataSecond item <span style='color:#308080; '>:</span> lcds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>item<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>></span> high<span style='color:#308080; '>)</span> <span style='color:#595979; '>// ></span>
				high <span style='color:#308080; '>=</span> item<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>item<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>&lt;</span> low<span style='color:#308080; '>)</span> <span style='color:#595979; '>// &lt;</span>
				low <span style='color:#308080; '>=</span> item<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
			
			turnover <span style='color:#308080; '>=</span> turnover<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span>item<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			qty <span style='color:#308080; '>+</span><span style='color:#308080; '>=</span> item<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
			<span style='color:#595979; '>// </span><span style='color:#ffffff; background:#808000; '>todo: cutoff			</span>
		<span style='color:#406080; '>}</span>
		
		cds<span style='color:#308080; '>.</span>setHigh<span style='color:#308080; '>(</span>high<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setLow<span style='color:#308080; '>(</span>low<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setQty<span style='color:#308080; '>(</span>qty<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setTurnover<span style='color:#308080; '>(</span>turnover<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cds<span style='color:#308080; '>.</span>setCutOff<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	<span style='color:#595979; '>// </span><span style='color:#ffffff; background:#808000; '>TODO: need fix once we have cutoff</span>
		
		<span style='color:#200080; font-weight:bold; '>return</span> cds<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#595979; '>//@Cacheable("CDStoCDD")		</span>
	<span style='color:#200080; font-weight:bold; '>private</span> ChartdataData CDStoCDD<span style='color:#308080; '>(</span>ChartdataSecond cds<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		ChartdataData cdd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> ChartdataData<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>O <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getOpen<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>H <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getHigh<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>L <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getLow<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>C <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getClose<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>V <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getQty<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>TO <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getTurnover<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>CO <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getCutOff<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
		
		<span style='color:#7779bb; '>long</span> t <span style='color:#308080; '>=</span> cds<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#406080; '>;</span>
		cdd<span style='color:#308080; '>.</span>T <span style='color:#308080; '>=</span> t<span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>return</span> cdd<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getChartDataMap")</span>		
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> getChartDataMap<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>// map items into [timestamp][list]</span>
		<span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>HashMap</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 
						
		lcds<span style='color:#308080; '>.</span>forEach<span style='color:#308080; '>(</span>item<span style='color:#308080; '>-</span><span style='color:#308080; '>></span><span style='color:#406080; '>{</span>						
			<span style='color:#6679aa; font-weight:bold; '>Date</span> dt <span style='color:#308080; '>=</span> item<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#6679aa; font-weight:bold; '>Integer</span> epochtime <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>int</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>(</span>dt<span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			<span style='color:#6679aa; font-weight:bold; '>Integer</span> key <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#308080; '>(</span><span style='color:#7779bb; '>int</span><span style='color:#308080; '>)</span> <span style='color:#6679aa; font-weight:bold; '>Math</span><span style='color:#308080; '>.</span>floor<span style='color:#308080; '>(</span>epochtime <span style='color:#308080; '>/</span> second<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>*</span> second<span style='color:#406080; '>;</span> 				

			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span><span style='color:#308080; '>!</span>mkeylist<span style='color:#308080; '>.</span>containsKey<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
				mkeylist<span style='color:#308080; '>.</span>put<span style='color:#308080; '>(</span>key<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

			mkeylist<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span>item<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
			<span style='color:#595979; '>//System.out.println("key: " + key + " value: " + dt.toString());</span>
		<span style='color:#406080; '>}</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#200080; font-weight:bold; '>return</span> mkeylist<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>		
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getChartDataMapDaily")</span>		
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> getChartDataMap<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds<span style='color:#308080; '>,</span> LocalTime lt<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>// map items into [timestamp][list]</span>
		<span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>HashMap</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 		
		<span style='color:#6679aa; font-weight:bold; '>Integer</span> prev_time <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span><span style='color:#406080; '>;</span>
						
		lcds<span style='color:#308080; '>.</span>forEach<span style='color:#308080; '>(</span>item<span style='color:#308080; '>-</span><span style='color:#308080; '>></span><span style='color:#406080; '>{</span>	
			<span style='color:#6679aa; font-weight:bold; '>Date</span> dt <span style='color:#308080; '>=</span> item<span style='color:#308080; '>.</span>getMktDatetime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#6679aa; font-weight:bold; '>Integer</span> epochtime <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>int</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>(</span>dt<span style='color:#308080; '>.</span>getTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			
			<span style='color:#595979; '>// </span><span style='color:#ffffff; background:#808000; '>TODO: May contain bug, probably rewrite code as logic is based on PHP code</span>
			LocalDateTime ldt <span style='color:#308080; '>=</span> dt<span style='color:#308080; '>.</span>toInstant<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>atZone<span style='color:#308080; '>(</span>ZoneId<span style='color:#308080; '>.</span>systemDefault<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>toLocalDateTime<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>					
			<span style='color:#6679aa; font-weight:bold; '>Calendar</span> cal <span style='color:#308080; '>=</span> <span style='color:#6679aa; font-weight:bold; '>Calendar</span><span style='color:#308080; '>.</span>getInstance<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
			cal<span style='color:#308080; '>.</span>set<span style='color:#308080; '>(</span>ldt<span style='color:#308080; '>.</span>getYear<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> ldt<span style='color:#308080; '>.</span>getMonthValue<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> ldt<span style='color:#308080; '>.</span>getDayOfMonth<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> lt<span style='color:#308080; '>.</span>getHour<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> lt<span style='color:#308080; '>.</span>getMinute<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> lt<span style='color:#308080; '>.</span>getSecond<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#6679aa; font-weight:bold; '>Integer</span> cutofftime <span style='color:#308080; '>=</span> <span style='color:#308080; '>(</span><span style='color:#7779bb; '>int</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>(</span>cal<span style='color:#308080; '>.</span>getTimeInMillis<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>/</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			
			<span style='color:#595979; '>// set cut off?</span>
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>prev_time <span style='color:#308080; '>&lt;</span> cutofftime <span style='color:#308080; '>&amp;</span><span style='color:#308080; '>&amp;</span> epochtime <span style='color:#308080; '>></span><span style='color:#308080; '>=</span> cutofftime<span style='color:#308080; '>)</span>
				item<span style='color:#308080; '>.</span>setCutOff<span style='color:#308080; '>(</span><span style='color:#008c00; '>1</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#200080; font-weight:bold; '>else</span>
				item<span style='color:#308080; '>.</span>setCutOff<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
			<span style='color:#595979; '>// why?</span>
			<span style='color:#595979; '>//prev_time = epochtime;</span>
			
			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>epochtime <span style='color:#308080; '>&lt;</span> cutofftime<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
				cutofftime <span style='color:#308080; '>-</span><span style='color:#308080; '>=</span> <span style='color:#008c00; '>86400</span><span style='color:#406080; '>;</span>
			<span style='color:#406080; '>}</span>
			<span style='color:#6679aa; font-weight:bold; '>Integer</span> key <span style='color:#308080; '>=</span> cutofftime<span style='color:#406080; '>;</span>	<span style='color:#595979; '>// may be error here?						</span>

			<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span><span style='color:#308080; '>!</span>mkeylist<span style='color:#308080; '>.</span>containsKey<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
				mkeylist<span style='color:#308080; '>.</span>put<span style='color:#308080; '>(</span>key<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>

			mkeylist<span style='color:#308080; '>.</span>get<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span>item<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
			<span style='color:#595979; '>//System.out.println("key: " + key + " value: " + dt.toString());</span>
		<span style='color:#406080; '>}</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#200080; font-weight:bold; '>return</span> mkeylist<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>	
		
	<span style='color:#595979; '>//@Cacheable("getChartDataMap")		</span>
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> getChartDataMap<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lcdo <span style='color:#308080; '>=</span> cdsr<span style='color:#308080; '>.</span>getListChartData<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#200080; font-weight:bold; '>for</span><span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span> o<span style='color:#308080; '>:</span> lcdo<span style='color:#308080; '>)</span><span style='color:#406080; '>{</span>        
			lcds<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>ChartdataSecond<span style='color:#308080; '>)</span>o<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>        
		<span style='color:#406080; '>}</span>		
		
		<span style='color:#595979; '>// </span><span style='color:#ffffff; background:#808000; '>TODO: may need to move to getChartDataHistory</span>
		<span style='color:#595979; '>// this is daily chart, need to make adjustment for OHLC base on different market trading hours</span>
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>second <span style='color:#308080; '>></span><span style='color:#308080; '>=</span> <span style='color:#008c00; '>86400</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>					
			LocalTime lt <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>getCutOffTime<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
			<span style='color:#200080; font-weight:bold; '>return</span> getChartDataMap<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>,</span> lt<span style='color:#308080; '>,</span> second<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		<span style='color:#406080; '>}</span>		
		<span style='color:#200080; font-weight:bold; '>return</span> getChartDataMap<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>,</span> second<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getChartDataHistory")</span>		
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> getChartDataHistory<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		
    	IChartData pcd <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#406080; '>;</span>		
    	    	
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>second <span style='color:#308080; '>&lt;</span> <span style='color:#008c00; '>3600</span><span style='color:#308080; '>)</span>			pcd <span style='color:#308080; '>=</span> cdmr<span style='color:#406080; '>;</span>		
		<span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>second <span style='color:#308080; '>&lt;</span> <span style='color:#008c00; '>86400</span><span style='color:#308080; '>)</span>	pcd <span style='color:#308080; '>=</span> cdhr<span style='color:#406080; '>;</span>
		<span style='color:#200080; font-weight:bold; '>else</span>						pcd <span style='color:#308080; '>=</span> cddr<span style='color:#406080; '>;</span>	    	  

		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span> lcds <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>		
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Object</span><span style='color:#308080; '>[</span><span style='color:#308080; '>]</span><span style='color:#308080; '>></span> lcdo <span style='color:#308080; '>=</span> pcd<span style='color:#308080; '>.</span>getListChartData<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
		
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>pcd <span style='color:#200080; font-weight:bold; '>instanceof</span> ChartdataMinuteRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			<span style='color:#200080; font-weight:bold; '>for</span><span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span> o<span style='color:#308080; '>:</span> lcdo<span style='color:#308080; '>)</span>
				lcds<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>new</span> ChartdataSecond<span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>ChartdataMinute<span style='color:#308080; '>)</span> o<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>  				
		<span style='color:#406080; '>}</span> <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>pcd <span style='color:#200080; font-weight:bold; '>instanceof</span> ChartdataHourRepository<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span> 
			<span style='color:#200080; font-weight:bold; '>for</span><span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span> o<span style='color:#308080; '>:</span> lcdo<span style='color:#308080; '>)</span>
				lcds<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>new</span> ChartdataSecond<span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>ChartdataHour<span style='color:#308080; '>)</span> o<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 	
		<span style='color:#406080; '>}</span> <span style='color:#200080; font-weight:bold; '>else</span> <span style='color:#406080; '>{</span>
			<span style='color:#200080; font-weight:bold; '>for</span><span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Object</span> o<span style='color:#308080; '>:</span> lcdo<span style='color:#308080; '>)</span>
				lcds<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>new</span> ChartdataSecond<span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>ChartdataDaily<span style='color:#308080; '>)</span> o<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 		
		<span style='color:#406080; '>}</span>
		
		<span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist <span style='color:#308080; '>=</span> getChartDataMap<span style='color:#308080; '>(</span>lcds<span style='color:#308080; '>,</span> second<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>// map items into [time][ChartdataSecond] with OHLC</span>
		<span style='color:#200080; font-weight:bold; '>return</span> getListChartdataData<span style='color:#308080; '>(</span>mkeylist<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("setCutOffLine")</span>	
	<span style='color:#7f9fbf; font-weight:bold; '>@SuppressWarnings("deprecation")</span>
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> setCutOffLine<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdj<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>// indicate cutoff time, fast hack, may need re-factoring</span>
		LocalTime lt <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>this</span><span style='color:#308080; '>.</span>getCutOffTime<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		<span style='color:#7779bb; '>boolean</span> cutoff_first_found <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>false</span><span style='color:#406080; '>;</span>
		
		<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>lt <span style='color:#308080; '>!</span><span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>null</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
			<span style='color:#200080; font-weight:bold; '>for</span><span style='color:#308080; '>(</span>ChartdataData cdd<span style='color:#308080; '>:</span> lcdj<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
				<span style='color:#6679aa; font-weight:bold; '>Date</span> date <span style='color:#308080; '>=</span> SPCommon<span style='color:#308080; '>.</span>GetDateTime<span style='color:#308080; '>(</span>cdd<span style='color:#308080; '>.</span>T<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				
				<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>date<span style='color:#308080; '>.</span>getHours<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> lt<span style='color:#308080; '>.</span>getHour<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>				
					<span style='color:#200080; font-weight:bold; '>if</span> <span style='color:#308080; '>(</span>cutoff_first_found <span style='color:#308080; '>=</span><span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>true</span><span style='color:#308080; '>)</span>
						<span style='color:#200080; font-weight:bold; '>continue</span><span style='color:#406080; '>;</span>
					
					cutoff_first_found <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>true</span><span style='color:#406080; '>;</span>				
					cdd<span style='color:#308080; '>.</span>CO <span style='color:#308080; '>=</span> <span style='color:#008c00; '>1</span><span style='color:#406080; '>;</span>				
				<span style='color:#406080; '>}</span>
				<span style='color:#200080; font-weight:bold; '>else</span>
					cutoff_first_found <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>false</span><span style='color:#406080; '>;</span>								
				<span style='color:#595979; '>//SPCommon.ConsoleLog("%s : %s : %s : %s", date, cdd.O, cdd.C, cdd.CO);			</span>
			<span style='color:#406080; '>}</span>
		<span style='color:#406080; '>}</span>		
		<span style='color:#200080; font-weight:bold; '>return</span> lcdj<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#595979; '>//@Cacheable("sortChartDataData")	</span>
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> sortChartDataData<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdj<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>// sort by time</span>
		<span style='color:#6679aa; font-weight:bold; '>Collections</span><span style='color:#308080; '>.</span>sort<span style='color:#308080; '>(</span>lcdj<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>Comparator</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>{</span>
			<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
			<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#7779bb; '>int</span> compare<span style='color:#308080; '>(</span>ChartdataData o1<span style='color:#308080; '>,</span> ChartdataData o2<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
				<span style='color:#6679aa; font-weight:bold; '>Date</span> d1 <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>Date</span><span style='color:#308080; '>(</span>o1<span style='color:#308080; '>.</span>T <span style='color:#308080; '>*</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				<span style='color:#6679aa; font-weight:bold; '>Date</span> d2 <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>Date</span><span style='color:#308080; '>(</span>o2<span style='color:#308080; '>.</span>T <span style='color:#308080; '>*</span> <span style='color:#008c00; '>1000</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
				<span style='color:#200080; font-weight:bold; '>return</span> d1<span style='color:#308080; '>.</span>compareTo<span style='color:#308080; '>(</span>d2<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			<span style='color:#406080; '>}</span>
		<span style='color:#406080; '>}</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
		<span style='color:#200080; font-weight:bold; '>return</span> lcdj<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getListChartdataData")</span>		
	<span style='color:#200080; font-weight:bold; '>private</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> getListChartdataData<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>
		<span style='color:#595979; '>// map items into [time][ChartdataSecond] with OHLC</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdj <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>ArrayList</span><span style='color:#308080; '>&lt;</span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		mkeylist<span style='color:#308080; '>.</span>forEach<span style='color:#308080; '>(</span><span style='color:#308080; '>(</span>k<span style='color:#308080; '>,</span> v<span style='color:#308080; '>)</span><span style='color:#308080; '>-</span><span style='color:#308080; '>></span><span style='color:#406080; '>{</span>				
			ChartdataSecond cds <span style='color:#308080; '>=</span> GetOHLC<span style='color:#308080; '>(</span>v<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
			ChartdataData cdj <span style='color:#308080; '>=</span> CDStoCDD<span style='color:#308080; '>(</span>cds<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
			lcdj<span style='color:#308080; '>.</span>add<span style='color:#308080; '>(</span>cdj<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
			<span style='color:#595979; '>//System.out.println("key: " + k + " value: " + v.get(0).getMktDatetime().toString() + cdj.T.toString());	</span>
		<span style='color:#406080; '>}</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>				
		<span style='color:#200080; font-weight:bold; '>return</span> lcdj<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#7f9fbf; font-weight:bold; '>@Cacheable("getChartDataCached")</span>		
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> getChartDataCached<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>		
		<span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>HashMap</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 
		
		<span style='color:#595979; '>// get today data (fill the gap)</span>
		<span style='color:#6679aa; font-weight:bold; '>Date</span> today <span style='color:#308080; '>=</span> SPCommon<span style='color:#308080; '>.</span>GetDateTime<span style='color:#308080; '>(</span>SPCommon<span style='color:#308080; '>.</span>GetDayStartDate<span style='color:#308080; '>(</span><span style='color:#008c00; '>0</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 						
		mkeylist <span style='color:#308080; '>=</span> getChartDataMap<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> second<span style='color:#308080; '>,</span> today<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
		<span style='color:#595979; '>// map items into [time][ChartdataSecond] with OHLC		</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdj <span style='color:#308080; '>=</span> getListChartdataData<span style='color:#308080; '>(</span>mkeylist<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
			
		<span style='color:#595979; '>// get from history tables if needed</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdh <span style='color:#308080; '>=</span> getChartDataHistory<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> second<span style='color:#308080; '>,</span> from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>// append history data to today's data</span>
		lcdj<span style='color:#308080; '>.</span>addAll<span style='color:#308080; '>(</span>lcdh<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
		
		<span style='color:#595979; '>// sort by time</span>
		lcdj <span style='color:#308080; '>=</span> sortChartDataData<span style='color:#308080; '>(</span>lcdj<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>// set daily cutoff time (line in chart)</span>
		lcdj <span style='color:#308080; '>=</span> setCutOffLine<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> lcdj<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
											
		<span style='color:#200080; font-weight:bold; '>return</span> lcdj<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>	
	
	<span style='color:#7f9fbf; font-weight:bold; '>@Override</span>
	<span style='color:#200080; font-weight:bold; '>public</span> <span style='color:#6679aa; font-weight:bold; '>Iterable</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> getChartDataCurrent<span style='color:#308080; '>(</span><span style='color:#6679aa; font-weight:bold; '>String</span> prodcode<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Integer</span> second<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> from<span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>Date</span> to<span style='color:#308080; '>)</span> <span style='color:#406080; '>{</span>		
		<span style='color:#6679aa; font-weight:bold; '>Map</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span> mkeylist <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>new</span> <span style='color:#6679aa; font-weight:bold; '>HashMap</span><span style='color:#308080; '>&lt;</span><span style='color:#6679aa; font-weight:bold; '>Integer</span><span style='color:#308080; '>,</span> <span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataSecond<span style='color:#308080; '>></span><span style='color:#308080; '>></span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#406080; '>;</span> 		
		mkeylist <span style='color:#308080; '>=</span> getChartDataMap<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> second<span style='color:#308080; '>,</span> from<span style='color:#308080; '>,</span> to<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>	
			
		<span style='color:#595979; '>// map items into [time][ChartdataSecond] with OHLC		</span>
		<span style='color:#6679aa; font-weight:bold; '>List</span><span style='color:#308080; '>&lt;</span>ChartdataData<span style='color:#308080; '>></span> lcdj <span style='color:#308080; '>=</span> getListChartdataData<span style='color:#308080; '>(</span>mkeylist<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>			
		
		<span style='color:#595979; '>// sort by time</span>
		lcdj <span style='color:#308080; '>=</span> sortChartDataData<span style='color:#308080; '>(</span>lcdj<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
		
		<span style='color:#595979; '>// set daily cutoff time (line in chart)</span>
		lcdj <span style='color:#308080; '>=</span> setCutOffLine<span style='color:#308080; '>(</span>prodcode<span style='color:#308080; '>,</span> lcdj<span style='color:#308080; '>)</span><span style='color:#406080; '>;</span>
											
		<span style='color:#200080; font-weight:bold; '>return</span> lcdj<span style='color:#406080; '>;</span>
	<span style='color:#406080; '>}</span>	
<span style='color:#406080; '>}</span>
</pre>
<!--Created using ToHtml.com on 2021-06-08 06:51:23 UTC -->