<pre style='color:#000020;background:#f6f8ff;'><span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>IO
<span style='color:#200080; font-weight:bold; '>Imports</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Security<span style='color:#008c00; '>.</span>Cryptography

<span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Class</span> CryptoModule
    <span style='color:#595979; '>' define the triple des provider</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> m_des <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> TripleDESCryptoServiceProvider

    <span style='color:#595979; '>' define the local property arrays</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> m_key<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span>
    <span style='color:#200080; font-weight:bold; '>Private</span> m_iv<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> {<span style='color:#008c00; '>8</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>7</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>6</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>5</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>3</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>14</span>}

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> ByteArrayToHex<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> data <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> sb <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>StringBuilder<span style='color:#308080; '>(</span>data<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>*</span> <span style='color:#008c00; '>2</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>For</span> <span style='color:#200080; font-weight:bold; '>Each</span> <span style='color:#200080; font-weight:bold; '>val</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#200080; font-weight:bold; '>In</span> data
            sb<span style='color:#008c00; '>.</span>Append<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>val</span><span style='color:#008c00; '>.</span>ToString<span style='color:#308080; '>(</span><span style='color:#1060b6; '>"x2"</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> <span style='color:#200080; font-weight:bold; '>val</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> sb<span style='color:#008c00; '>.</span>ToString
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> HexToByteArray<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>text</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> output<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>text</span><span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>*</span> <span style='color:#008c00; '>0.5</span> <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span>
        <span style='color:#200080; font-weight:bold; '>For</span> i <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#200080; font-weight:bold; '>To</span> output<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span>
            output<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> Convert<span style='color:#008c00; '>.</span>ToByte<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>text</span><span style='color:#008c00; '>.</span>Substring<span style='color:#308080; '>(</span>i <span style='color:#308080; '>*</span> <span style='color:#008c00; '>2</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>2</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>16</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> i
        <span style='color:#200080; font-weight:bold; '>Return</span> output
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> MassageKey<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> bHeader<span style='color:#308080; '>(</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> bTrailer<span style='color:#308080; '>(</span><span style='color:#008c00; '>3</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#595979; '>'create 4 random bytes before and after the 192-bit encryption key</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>rnd</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> Random<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>rnd</span><span style='color:#008c00; '>.</span>NextBytes<span style='color:#308080; '>(</span>bHeader<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>rnd</span><span style='color:#008c00; '>.</span>NextBytes<span style='color:#308080; '>(</span>bTrailer<span style='color:#308080; '>)</span>

        <span style='color:#200080; font-weight:bold; '>Dim</span> bOldKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>For</span> i <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#200080; font-weight:bold; '>To</span> bOldKey<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span>
            bOldKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> bOldKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>+</span> <span style='color:#008c00; '>10</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> i

        <span style='color:#200080; font-weight:bold; '>Dim</span> bNewKey<span style='color:#308080; '>(</span><span style='color:#008c00; '>31</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#595979; '>'total massaged key length 32 bytes</span>
        <span style='color:#200080; font-weight:bold; '>Array</span><span style='color:#008c00; '>.</span>Copy<span style='color:#308080; '>(</span>bHeader<span style='color:#308080; '>,</span> bNewKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#308080; '>)</span> <span style='color:#595979; '>'put 4 bytes header before key</span>
        <span style='color:#200080; font-weight:bold; '>Array</span><span style='color:#008c00; '>.</span>Copy<span style='color:#308080; '>(</span>bOldKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> bNewKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>24</span><span style='color:#308080; '>)</span> <span style='color:#595979; '>'192-bit encryption key = 24 bytes</span>
        <span style='color:#200080; font-weight:bold; '>Array</span><span style='color:#008c00; '>.</span>Copy<span style='color:#308080; '>(</span>bTrailer<span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> bNewKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>28</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#308080; '>)</span> <span style='color:#595979; '>'put 4 bytes trailer after key</span>

        <span style='color:#200080; font-weight:bold; '>Return</span> bNewKey
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> UnMassageKey<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> bChoppedKey<span style='color:#308080; '>(</span><span style='color:#008c00; '>23</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span>
        <span style='color:#200080; font-weight:bold; '>Array</span><span style='color:#008c00; '>.</span>Copy<span style='color:#308080; '>(</span>key<span style='color:#308080; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#308080; '>,</span> bChoppedKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>24</span><span style='color:#308080; '>)</span> <span style='color:#595979; '>'skipping first 4 bytes random header, then get next 24 bytes as encryption key </span>
        <span style='color:#200080; font-weight:bold; '>For</span> i <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#200080; font-weight:bold; '>To</span> bChoppedKey<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span>
            bChoppedKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> bChoppedKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>-</span> <span style='color:#008c00; '>10</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> i

        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetString<span style='color:#308080; '>(</span>bChoppedKey<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> UnMassageKeyString<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> bOldKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> bChoppedKey<span style='color:#308080; '>(</span><span style='color:#008c00; '>23</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span>
        <span style='color:#200080; font-weight:bold; '>Array</span><span style='color:#008c00; '>.</span>Copy<span style='color:#308080; '>(</span>bOldKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>4</span><span style='color:#308080; '>,</span> bChoppedKey<span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>24</span><span style='color:#308080; '>)</span> <span style='color:#595979; '>'skipping first 4 bytes random header, then get next 24 bytes as encryption key </span>
        <span style='color:#200080; font-weight:bold; '>For</span> i <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#200080; font-weight:bold; '>To</span> bChoppedKey<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span>
            bChoppedKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>=</span> bChoppedKey<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>-</span> <span style='color:#008c00; '>10</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> i

        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetString<span style='color:#308080; '>(</span>bChoppedKey<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> HashMessage<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>text</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> md5Hasher <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> MD5CryptoServiceProvider
        <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>UTF8Encoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>text</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> md5Hasher<span style='color:#008c00; '>.</span>ComputeHash<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> CompareHash<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> input1<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> input2<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Boolean</span>
        <span style='color:#200080; font-weight:bold; '>For</span> i <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Integer</span> <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span> <span style='color:#200080; font-weight:bold; '>To</span> input1<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span>
            <span style='color:#200080; font-weight:bold; '>If</span> <span style='color:#308080; '>(</span>input1<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span> <span style='color:#308080; '>&lt;</span><span style='color:#308080; '>></span> input2<span style='color:#308080; '>(</span>i<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>Then</span>
                <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>False</span>
            <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>If</span>
        <span style='color:#200080; font-weight:bold; '>Next</span> i
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#0f4d75; '>True</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> EncryptTripleDES<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> sKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        m_key <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>sKey<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> Transform<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>,</span> m_des<span style='color:#008c00; '>.</span>CreateEncryptor<span style='color:#308080; '>(</span>m_key<span style='color:#308080; '>,</span> m_iv<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> DecryptTripleDES<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> sKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        m_key <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>sKey<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> Transform<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>,</span> m_des<span style='color:#008c00; '>.</span>CreateDecryptor<span style='color:#308080; '>(</span>m_key<span style='color:#308080; '>,</span> m_iv<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> EncryptTripleDES<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> sKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>text</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        m_key <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>sKey<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>UTF8Encoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>text</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> output<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> Transform<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>,</span> m_des<span style='color:#008c00; '>.</span>CreateEncryptor<span style='color:#308080; '>(</span>m_key<span style='color:#308080; '>,</span> m_iv<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> ByteArrayToHex<span style='color:#308080; '>(</span>output<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> DecryptTripleDES<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> sKey <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>text</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        m_key <span style='color:#308080; '>=</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>ASCIIEncoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetBytes<span style='color:#308080; '>(</span>sKey<span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> HexToByteArray<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>text</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> output<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span> <span style='color:#308080; '>=</span> Transform<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>,</span> m_des<span style='color:#008c00; '>.</span>CreateDecryptor<span style='color:#308080; '>(</span>m_key<span style='color:#308080; '>,</span> m_iv<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> <span style='color:#200080; font-weight:bold; '>New</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span><span style='color:#200080; font-weight:bold; '>Text</span><span style='color:#008c00; '>.</span>UTF8Encoding<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span><span style='color:#308080; '>.</span>GetString<span style='color:#308080; '>(</span>output<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Private</span> <span style='color:#200080; font-weight:bold; '>Function</span> Transform<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> CryptoTransform <span style='color:#200080; font-weight:bold; '>As</span> ICryptoTransform<span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span><span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>
        <span style='color:#595979; '>' create the necessary streams</span>
        Using memStream <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> MemoryStream
            Using cryptStream <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>New</span> CryptoStream<span style='color:#308080; '>(</span>memStream<span style='color:#308080; '>,</span> CryptoTransform<span style='color:#308080; '>,</span> CryptoStreamMode<span style='color:#008c00; '>.</span>Write<span style='color:#308080; '>)</span>
                <span style='color:#595979; '>' transform the bytes as requested</span>
                cryptStream<span style='color:#008c00; '>.</span>Write<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>input</span><span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>input</span><span style='color:#008c00; '>.</span>Length<span style='color:#308080; '>)</span>
                cryptStream<span style='color:#008c00; '>.</span>FlushFinalBlock<span style='color:#308080; '>(</span><span style='color:#308080; '>)</span>

                <span style='color:#595979; '>' Read the memory stream and convert it back into byte array</span>
                memStream<span style='color:#008c00; '>.</span>Position <span style='color:#308080; '>=</span> <span style='color:#008c00; '>0</span>
                <span style='color:#200080; font-weight:bold; '>Dim</span> result<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>CType</span><span style='color:#308080; '>(</span>memStream<span style='color:#008c00; '>.</span>Length <span style='color:#308080; '>-</span> <span style='color:#008c00; '>1</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Int32<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>Byte</span>
                memStream<span style='color:#008c00; '>.</span>Read<span style='color:#308080; '>(</span>result<span style='color:#308080; '>,</span> <span style='color:#008c00; '>0</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>CType</span><span style='color:#308080; '>(</span>result<span style='color:#008c00; '>.</span>Length<span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>System</span><span style='color:#008c00; '>.</span>Int32<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>

                Transform <span style='color:#308080; '>=</span> result
            <span style='color:#200080; font-weight:bold; '>End</span> Using
        <span style='color:#200080; font-weight:bold; '>End</span> Using
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>

    <span style='color:#200080; font-weight:bold; '>Public</span> <span style='color:#200080; font-weight:bold; '>Function</span> BuildSVSWebViewerQueryString<span style='color:#308080; '>(</span><span style='color:#200080; font-weight:bold; '>ByVal</span> key <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>,</span> <span style='color:#200080; font-weight:bold; '>ByVal</span> directory <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span><span style='color:#308080; '>)</span> <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span>
        <span style='color:#200080; font-weight:bold; '>Dim</span> HashMsgInHex <span style='color:#200080; font-weight:bold; '>As</span> <span style='color:#200080; font-weight:bold; '>String</span> <span style='color:#308080; '>=</span> ByteArrayToHex<span style='color:#308080; '>(</span>HashMessage<span style='color:#308080; '>(</span>directory<span style='color:#308080; '>)</span><span style='color:#308080; '>)</span>
        <span style='color:#200080; font-weight:bold; '>Return</span> EncryptTripleDES<span style='color:#308080; '>(</span>UnMassageKeyString<span style='color:#308080; '>(</span>key<span style='color:#308080; '>)</span><span style='color:#308080; '>,</span> directory <span style='color:#308080; '>&amp;</span> <span style='color:#1060b6; '>"/"</span> <span style='color:#308080; '>&amp;</span> HashMsgInHex<span style='color:#308080; '>)</span>
    <span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Function</span>
<span style='color:#200080; font-weight:bold; '>End</span> <span style='color:#200080; font-weight:bold; '>Class</span>
</pre>
<!--Created using ToHtml.com on 2021-08-04 07:06:16 UTC -->