<pre style='color:#000000;background:#ffffff;'><span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Author:  Yee Hsu</span>
<span style='color:#008000; '>// Date:    6/8/2006</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Desc:    LZARI Compressor. This is a compression library that compresses</span>
<span style='color:#008000; '>//          any file by up to 90%. Very efficient and handy if you want to</span>
<span style='color:#008000; '>//          save storage space by compressing files into smaller ones.</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>stdafx.h</span><span style='color:#0000e6; '>"</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>LZARI_Compress.h</span><span style='color:#0000e6; '>"</span>

<span style='color:#008000; '>// init some static vars</span>
<span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>getbuffer    <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>putbuffer    <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>getmask    <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>putmask    <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>128</span><span style='color:#0000ff; '>;</span>

LZARI_Compress<span style='color:#0000ff; '>::</span>LZARI_Compress<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

LZARI_Compress<span style='color:#0000ff; '>::</span><span style='color:#0000ff; '>~</span>LZARI_Compress<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Error<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>char</span> <span style='color:#0000ff; '>*</span>message<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#008000; '>//printf("\n%s\n", message);</span>
    <span style='color:#0000ff; font-weight:bold; '>exit</span><span style='color:#0000ff; '>(</span>EXIT_FAILURE<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>PutBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> bit<span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Output one bit (bit = 0,1) */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#008000; '>//static unsigned int  buffer = 0, mask = 128;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>bit<span style='color:#0000ff; '>)</span> putbuffer <span style='color:#0000ff; '>|</span><span style='color:#0000ff; '>=</span> putmask<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>putmask <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>putc</span><span style='color:#0000ff; '>(</span>putbuffer<span style='color:#0000ff; '>,</span> outfile<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>EOF</span><span style='color:#0000ff; '>)</span> Error<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Write Error</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        putbuffer <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>  putmask <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>128</span><span style='color:#0000ff; '>;</span>  codesize<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>FlushBitBuffer<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Send remaining bits */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  i<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>7</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> PutBit<span style='color:#0000ff; '>(</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>GetBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Get one bit (0 or 1) */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#008000; '>//static unsigned int  buffer, mask = 0;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>getmask <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        getbuffer <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>getc</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  getmask <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>128</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>getbuffer <span style='color:#0000ff; '>&amp;</span> getmask<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>InitTree<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Initialize trees */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  i<span style='color:#0000ff; '>;</span>

    <span style='color:#008000; '>/* For i = 0 to N - 1, rson[i] and lson[i] will be the right and</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;left children of node i.  These nodes need not be initialized.</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;Also, dad[i] is the parent of node i.  These are initialized to</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;NIL (= N), which stands for 'not used.'</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;For i = 0 to 255, rson[N + i + 1] is the root of the tree</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;for strings that begin with character i.  These are initialized</span>
<span style='color:#008000; '>&#xa0;&#xa0;&#xa0;&#xa0;to NIL.  Note there are 256 trees. */</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> N <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> N <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>256</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> rson<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>;</span>    <span style='color:#008000; '>/* root */</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> N<span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> dad<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>;</span>    <span style='color:#008000; '>/* node */</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>InsertNode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> r<span style='color:#0000ff; '>)</span>
<span style='color:#008000; '>/* Inserts string of length F, text_buf[r..r+F-1], into one of the</span>
<span style='color:#008000; '>trees (text_buf[r]'th tree) and returns the longest-match position</span>
<span style='color:#008000; '>and length via the global variables match_position and match_length.</span>
<span style='color:#008000; '>If match_length = F, then removes the old node in favor of the new</span>
<span style='color:#008000; '>one, because the old one will be deleted sooner.</span>
<span style='color:#008000; '>Note r plays double role, as tree node and position in buffer. */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  i<span style='color:#0000ff; '>,</span> p<span style='color:#0000ff; '>,</span> cmp<span style='color:#0000ff; '>,</span> temp<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>char</span>  <span style='color:#0000ff; '>*</span>key<span style='color:#0000ff; '>;</span>

    cmp <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  key <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>&amp;</span>text_buf<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  p <span style='color:#0000ff; '>=</span> N <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span> <span style='color:#0000ff; '>+</span> key<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    rson<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>;</span>  match_length <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>cmp <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> p <span style='color:#0000ff; '>=</span> rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>  rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> p<span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> p <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>  lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> p<span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> F<span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>cmp <span style='color:#0000ff; '>=</span> key<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>-</span> text_buf<span style='color:#0000ff; '>[</span>p <span style='color:#0000ff; '>+</span> i<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span>  <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>></span> THRESHOLD<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>></span> match_length<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                match_position <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>-</span> p<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>match_length <span style='color:#0000ff; '>=</span> i<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> F<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> match_length<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>temp <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>-</span> p<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&lt;</span> match_position<span style='color:#0000ff; '>)</span>
                    match_position <span style='color:#0000ff; '>=</span> temp<span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>
    dad<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  lson<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  rson<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    dad<span style='color:#0000ff; '>[</span>lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> p<span style='color:#0000ff; '>)</span> rson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span>                   lson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> r<span style='color:#0000ff; '>;</span>
    dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* remove p */</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>DeleteNode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> p<span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Delete node p from tree */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  q<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* not in tree */</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> q <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> q <span style='color:#0000ff; '>=</span> rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
        q <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>do</span> <span style='color:#0000ff; '>{</span>  q <span style='color:#0000ff; '>=</span> rson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            rson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>lson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> dad<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
            lson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>lson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> q<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
        rson<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>  dad<span style='color:#0000ff; '>[</span>rson<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> q<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    dad<span style='color:#0000ff; '>[</span>q<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>rson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> p<span style='color:#0000ff; '>)</span> rson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> q<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span>                   lson<span style='color:#0000ff; '>[</span>dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> q<span style='color:#0000ff; '>;</span>
    dad<span style='color:#0000ff; '>[</span>p<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> NIL<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>/********** Arithmetic Compression **********/</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>StartModel<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Initialize model */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> ch<span style='color:#0000ff; '>,</span> sym<span style='color:#0000ff; '>,</span> i<span style='color:#0000ff; '>;</span>

    sym_cum<span style='color:#0000ff; '>[</span>N_CHAR<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>sym <span style='color:#0000ff; '>=</span> N_CHAR<span style='color:#0000ff; '>;</span> sym <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span> sym<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        ch <span style='color:#0000ff; '>=</span> sym <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>
        char_to_sym<span style='color:#0000ff; '>[</span>ch<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> sym<span style='color:#0000ff; '>;</span>  sym_to_char<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> ch<span style='color:#0000ff; '>;</span>
        sym_freq<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>
        sym_cum<span style='color:#0000ff; '>[</span>sym <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> sym_cum<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>+</span> sym_freq<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    sym_freq<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* sentinel (!= sym_freq[1]) */</span>
    position_cum<span style='color:#0000ff; '>[</span>N<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> N<span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span>
        position_cum<span style='color:#0000ff; '>[</span>i <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> position_cum<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>10000</span> <span style='color:#0000ff; '>/</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>200</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#008000; '>/* empirical distribution function (quite tentative) */</span>
    <span style='color:#008000; '>/* Please devise a better mechanism! */</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>UpdateModel<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> sym<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> i<span style='color:#0000ff; '>,</span> c<span style='color:#0000ff; '>,</span> ch_i<span style='color:#0000ff; '>,</span> ch_sym<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> MAX_CUM<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        c <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> N_CHAR<span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>></span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            sym_cum<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
            c <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>sym_freq<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>sym_freq<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>></span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
        sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> sym<span style='color:#0000ff; '>;</span> sym_freq<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> sym_freq<span style='color:#0000ff; '>[</span>i <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>&lt;</span> sym<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        ch_i <span style='color:#0000ff; '>=</span> sym_to_char<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>    ch_sym <span style='color:#0000ff; '>=</span> sym_to_char<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
        sym_to_char<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> ch_sym<span style='color:#0000ff; '>;</span>  sym_to_char<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> ch_i<span style='color:#0000ff; '>;</span>
        char_to_sym<span style='color:#0000ff; '>[</span>ch_i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> sym<span style='color:#0000ff; '>;</span>  char_to_sym<span style='color:#0000ff; '>[</span>ch_sym<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> i<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    sym_freq<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span>i <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> sym_cum<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Output<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> bit<span style='color:#0000ff; '>)</span>  <span style='color:#008000; '>/* Output 1 bit, followed by its complements */</span>
<span style='color:#0000ff; '>{</span>
    PutBit<span style='color:#0000ff; '>(</span>bit<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> shifts <span style='color:#0000ff; '>></span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> shifts<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>)</span> PutBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span> bit<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>EncodeChar<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> ch<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  sym<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span> <span style='color:#0000ff; font-weight:bold; '>int</span>  range<span style='color:#0000ff; '>;</span>

    sym <span style='color:#0000ff; '>=</span> char_to_sym<span style='color:#0000ff; '>[</span>ch<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    range <span style='color:#0000ff; '>=</span> high <span style='color:#0000ff; '>-</span> low<span style='color:#0000ff; '>;</span>
    high <span style='color:#0000ff; '>=</span> low <span style='color:#0000ff; '>+</span> <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> sym_cum<span style='color:#0000ff; '>[</span>sym <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>       <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> sym_cum<span style='color:#0000ff; '>[</span>sym    <span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q1 <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q3<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            shifts<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> low<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> high<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    UpdateModel<span style='color:#0000ff; '>(</span>sym<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>EncodePosition<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>int</span> position<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span> <span style='color:#0000ff; font-weight:bold; '>int</span>  range<span style='color:#0000ff; '>;</span>

    range <span style='color:#0000ff; '>=</span> high <span style='color:#0000ff; '>-</span> low<span style='color:#0000ff; '>;</span>
    high <span style='color:#0000ff; '>=</span> low <span style='color:#0000ff; '>+</span> <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> position_cum<span style='color:#0000ff; '>[</span>position    <span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> position_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>       <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> position_cum<span style='color:#0000ff; '>[</span>position <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> position_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q1 <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q3<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            shifts<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> low<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> high<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>EncodeEnd<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    shifts<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>&lt;</span> Q1<span style='color:#0000ff; '>)</span> Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>else</span> Output<span style='color:#0000ff; '>(</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    FlushBitBuffer<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* flush bits remaining in buffer */</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>BinarySearchSym<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> x<span style='color:#0000ff; '>)</span>
<span style='color:#008000; '>/* 1      if x >= sym_cum[1],</span>
<span style='color:#008000; '>N_CHAR if sym_cum[N_CHAR] > x,</span>
<span style='color:#008000; '>i such that sym_cum[i - 1] > x >= sym_cum[i] otherwise */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> i<span style='color:#0000ff; '>,</span> j<span style='color:#0000ff; '>,</span> k<span style='color:#0000ff; '>;</span>

    i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  j <span style='color:#0000ff; '>=</span> N_CHAR<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>&lt;</span> j<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        k <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>+</span> j<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> <span style='color:#800000; '>2</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>sym_cum<span style='color:#0000ff; '>[</span>k<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>></span> x<span style='color:#0000ff; '>)</span> i <span style='color:#0000ff; '>=</span> k <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>else</span> j <span style='color:#0000ff; '>=</span> k<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> i<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>BinarySearchPos<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span> x<span style='color:#0000ff; '>)</span>
<span style='color:#008000; '>/* 0 if x >= position_cum[1],</span>
<span style='color:#008000; '>N - 1 if position_cum[N] > x,</span>
<span style='color:#008000; '>i such that position_cum[i] > x >= position_cum[i + 1] otherwise */</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> i<span style='color:#0000ff; '>,</span> j<span style='color:#0000ff; '>,</span> k<span style='color:#0000ff; '>;</span>

    i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  j <span style='color:#0000ff; '>=</span> N<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>&lt;</span> j<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        k <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>+</span> j<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> <span style='color:#800000; '>2</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>position_cum<span style='color:#0000ff; '>[</span>k<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>></span> x<span style='color:#0000ff; '>)</span> i <span style='color:#0000ff; '>=</span> k <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>else</span> j <span style='color:#0000ff; '>=</span> k<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> i <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>StartDecode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> i<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> M <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>2</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span>
        value <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>2</span> <span style='color:#0000ff; '>*</span> value <span style='color:#0000ff; '>+</span> GetBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>DecodeChar<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>     sym<span style='color:#0000ff; '>,</span> ch<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span> <span style='color:#0000ff; font-weight:bold; '>int</span>  range<span style='color:#0000ff; '>;</span>

    range <span style='color:#0000ff; '>=</span> high <span style='color:#0000ff; '>-</span> low<span style='color:#0000ff; '>;</span>
    sym <span style='color:#0000ff; '>=</span> BinarySearchSym<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>value <span style='color:#0000ff; '>-</span> low <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>*</span> sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> range<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    high <span style='color:#0000ff; '>=</span> low <span style='color:#0000ff; '>+</span> <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> sym_cum<span style='color:#0000ff; '>[</span>sym <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>       <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> sym_cum<span style='color:#0000ff; '>[</span>sym    <span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> sym_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            value <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q1 <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q3<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            value <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>high <span style='color:#0000ff; '>></span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> low<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> high<span style='color:#0000ff; '>;</span>
        value <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>2</span> <span style='color:#0000ff; '>*</span> value <span style='color:#0000ff; '>+</span> GetBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    ch <span style='color:#0000ff; '>=</span> sym_to_char<span style='color:#0000ff; '>[</span>sym<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    UpdateModel<span style='color:#0000ff; '>(</span>sym<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> ch<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>int</span> LZARI_Compress<span style='color:#0000ff; '>::</span>DecodePosition<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span> position<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span> <span style='color:#0000ff; font-weight:bold; '>int</span>  range<span style='color:#0000ff; '>;</span>

    range <span style='color:#0000ff; '>=</span> high <span style='color:#0000ff; '>-</span> low<span style='color:#0000ff; '>;</span>
    position <span style='color:#0000ff; '>=</span> BinarySearchPos<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>int</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>value <span style='color:#0000ff; '>-</span> low <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>*</span> position_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> range<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    high <span style='color:#0000ff; '>=</span> low <span style='color:#0000ff; '>+</span> <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> position_cum<span style='color:#0000ff; '>[</span>position    <span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> position_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span>       <span style='color:#0000ff; '>(</span>range <span style='color:#0000ff; '>*</span> position_cum<span style='color:#0000ff; '>[</span>position <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>/</span> position_cum<span style='color:#0000ff; '>[</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            value <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q2<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>low <span style='color:#0000ff; '>></span><span style='color:#0000ff; '>=</span> Q1 <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> high <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> Q3<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            value <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  low <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>=</span> Q1<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>high <span style='color:#0000ff; '>></span> Q2<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>break</span><span style='color:#0000ff; '>;</span>
        low <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> low<span style='color:#0000ff; '>;</span>  high <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> high<span style='color:#0000ff; '>;</span>
        value <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>2</span> <span style='color:#0000ff; '>*</span> value <span style='color:#0000ff; '>+</span> GetBit<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> position<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>/********** Encode and Decode **********/</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Encode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  i<span style='color:#0000ff; '>,</span> c<span style='color:#0000ff; '>,</span> len<span style='color:#0000ff; '>,</span> r<span style='color:#0000ff; '>,</span> s<span style='color:#0000ff; '>,</span> last_match_length<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>fseek</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>,</span> SEEK_END<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    textsize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>ftell</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>fwrite</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>textsize<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span> textsize<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>,</span> outfile<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span>
        Error<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Write Error</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* output size of text */</span>
    codesize <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span> textsize<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>textsize <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>rewind</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  textsize <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    StartModel<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  InitTree<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    s <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>  r <span style='color:#0000ff; '>=</span> N <span style='color:#0000ff; '>-</span> F<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> s<span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> r<span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> text_buf<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#000080; '>' '</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>len <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> len <span style='color:#0000ff; '>&lt;</span> F <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>c <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>getc</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>EOF</span><span style='color:#0000ff; '>;</span> len<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span>
        text_buf<span style='color:#0000ff; '>[</span>r <span style='color:#0000ff; '>+</span> len<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
    textsize <span style='color:#0000ff; '>=</span> len<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> F<span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> InsertNode<span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>-</span> i<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    InsertNode<span style='color:#0000ff; '>(</span>r<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>do</span> <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>match_length <span style='color:#0000ff; '>></span> len<span style='color:#0000ff; '>)</span> match_length <span style='color:#0000ff; '>=</span> len<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>match_length <span style='color:#0000ff; '>&lt;</span><span style='color:#0000ff; '>=</span> THRESHOLD<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            match_length <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>;</span>  EncodeChar<span style='color:#0000ff; '>(</span>text_buf<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
            EncodeChar<span style='color:#0000ff; '>(</span><span style='color:#800000; '>255</span> <span style='color:#0000ff; '>-</span> THRESHOLD <span style='color:#0000ff; '>+</span> match_length<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            EncodePosition<span style='color:#0000ff; '>(</span>match_position <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
        last_match_length <span style='color:#0000ff; '>=</span> match_length<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> last_match_length <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span>
            <span style='color:#0000ff; '>(</span>c <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>getc</span><span style='color:#0000ff; '>(</span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>EOF</span><span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                DeleteNode<span style='color:#0000ff; '>(</span>s<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  text_buf<span style='color:#0000ff; '>[</span>s<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
                <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>s <span style='color:#0000ff; '>&lt;</span> F <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> text_buf<span style='color:#0000ff; '>[</span>s <span style='color:#0000ff; '>+</span> N<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
                s <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>s <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                r <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                InsertNode<span style='color:#0000ff; '>(</span>r<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span>
            <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>textsize <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> i<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>></span> printcount<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                <span style='color:#008000; '>//printf("%12ld\r", textsize); </span>
                printcount <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1024</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span>
            <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span>i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span> <span style='color:#0000ff; '>&lt;</span> last_match_length<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                DeleteNode<span style='color:#0000ff; '>(</span>s<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                s <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>s <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                r <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
                <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>-</span>len<span style='color:#0000ff; '>)</span> InsertNode<span style='color:#0000ff; '>(</span>r<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>while</span> <span style='color:#0000ff; '>(</span>len <span style='color:#0000ff; '>></span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    EncodeEnd<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#008000; '>//printf("In : %lu bytes\n", textsize);</span>
    <span style='color:#008000; '>//printf("Out: %lu bytes\n", codesize);</span>
    <span style='color:#008000; '>//printf("Out/In: %.3f\n", (double)codesize / textsize);</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Decode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>int</span>  i<span style='color:#0000ff; '>,</span> j<span style='color:#0000ff; '>,</span> k<span style='color:#0000ff; '>,</span> r<span style='color:#0000ff; '>,</span> c<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>unsigned</span> <span style='color:#0000ff; font-weight:bold; '>long</span> <span style='color:#0000ff; font-weight:bold; '>int</span>  <span style='color:#0000ff; font-weight:bold; '>count</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>fread</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>&amp;</span>textsize<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span> textsize<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>,</span> infile<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span>
        Error<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>Read Error</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>/* read size of text */</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>textsize <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; font-weight:bold; '>return</span><span style='color:#0000ff; '>;</span>
    StartDecode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  StartModel<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> i <span style='color:#0000ff; '>&lt;</span> N <span style='color:#0000ff; '>-</span> F<span style='color:#0000ff; '>;</span> i<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> text_buf<span style='color:#0000ff; '>[</span>i<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#000080; '>' '</span><span style='color:#0000ff; '>;</span>
    r <span style='color:#0000ff; '>=</span> N <span style='color:#0000ff; '>-</span> F<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>count</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> <span style='color:#0000ff; font-weight:bold; '>count</span> <span style='color:#0000ff; '>&lt;</span> textsize<span style='color:#0000ff; '>;</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
        c <span style='color:#0000ff; '>=</span> DecodeChar<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>c <span style='color:#0000ff; '>&lt;</span> <span style='color:#800000; '>256</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>putc</span><span style='color:#0000ff; '>(</span>c<span style='color:#0000ff; '>,</span> outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  text_buf<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
            r <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>count</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span> <span style='color:#0000ff; font-weight:bold; '>else</span> <span style='color:#0000ff; '>{</span>
            i <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>r <span style='color:#0000ff; '>-</span> DecodePosition<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            j <span style='color:#0000ff; '>=</span> c <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>255</span> <span style='color:#0000ff; '>+</span> THRESHOLD<span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>for</span> <span style='color:#0000ff; '>(</span>k <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span> k <span style='color:#0000ff; '>&lt;</span> j<span style='color:#0000ff; '>;</span> k<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
                c <span style='color:#0000ff; '>=</span> text_buf<span style='color:#0000ff; '>[</span><span style='color:#0000ff; '>(</span>i <span style='color:#0000ff; '>+</span> k<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
                <span style='color:#0000ff; font-weight:bold; '>putc</span><span style='color:#0000ff; '>(</span>c<span style='color:#0000ff; '>,</span> outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  text_buf<span style='color:#0000ff; '>[</span>r<span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> c<span style='color:#0000ff; '>;</span>
                r <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>N <span style='color:#0000ff; '>-</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>  <span style='color:#0000ff; font-weight:bold; '>count</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; '>}</span>
        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>count</span> <span style='color:#0000ff; '>></span> printcount<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>{</span>
            <span style='color:#008000; '>//printf("%12lu\r", count);  </span>
            printcount <span style='color:#0000ff; '>+</span><span style='color:#0000ff; '>=</span> <span style='color:#800000; '>1024</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#008000; '>//printf("%12lu\n", count);</span>
<span style='color:#0000ff; '>}</span>


<span style='color:#008000; '>/*******************   DONT MODIFY ANYTHING UP THERE   ********************************* */</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> LZARI_Compress<span style='color:#0000ff; '>::</span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#008000; '>// reset statics vars</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>putmask <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>128</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>getbuffer    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>putbuffer <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>getmask <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

    <span style='color:#008000; '>// reset values</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>textsize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>codesize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>printcount <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>match_length  <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>match_position <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>shifts <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>low <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>value <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>high <span style='color:#0000ff; '>=</span> Q4<span style='color:#0000ff; '>;</span>

    <span style='color:#008000; '>// zero all memories</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>text_buf<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>text_buf<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lson<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lson<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>rson<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>rson<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dad<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dad<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>char_to_sym<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>char_to_sym<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_to_char<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_to_char<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_freq<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_freq<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_cum<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sym_cum<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>position_cum<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>sizeof</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>position_cum<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> LZARI_Compress<span style='color:#0000ff; '>::</span>ReadFileContents<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sFile<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>&amp;</span> sOut<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>FILE</span><span style='color:#0000ff; '>*</span> iFile <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>(</span>iFile <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sFile<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>rb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>fseek</span><span style='color:#0000ff; '>(</span>iFile<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>,</span> SEEK_END<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>long</span> nSize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>ftell</span><span style='color:#0000ff; '>(</span>iFile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>char</span> <span style='color:#0000ff; '>*</span>pBuffer <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>new</span> <span style='color:#0000ff; font-weight:bold; '>char</span><span style='color:#0000ff; '>[</span>nSize<span style='color:#0000ff; '>+</span><span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fseek</span><span style='color:#0000ff; '>(</span>iFile<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>,</span> SEEK_SET<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fread</span><span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>,</span> nSize<span style='color:#0000ff; '>,</span> iFile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        pBuffer<span style='color:#0000ff; '>[</span>nSize<span style='color:#0000ff; '>]</span> <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>

        sOut<span style='color:#0000ff; '>.</span>clear<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        sOut<span style='color:#0000ff; '>.</span>assign<span style='color:#0000ff; '>(</span>pBuffer<span style='color:#0000ff; '>,</span> pBuffer <span style='color:#0000ff; '>+</span> nSize<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>        <span style='color:#008000; '>// may contain multibyte binary data</span>

        <span style='color:#0000ff; font-weight:bold; '>delete</span> pBuffer<span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span>iFile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Compress_From_File_To_File<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>int</span> METHOD_FLAG<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sIn<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sOut<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>rb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sOut<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        METHOD_FLAG <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> METHOD_DEFLATE <span style='color:#0000ff; '>?</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Encode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Decode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>        

        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Compress_From_File_To_Data<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>int</span> METHOD_FLAG<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sIn<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>&amp;</span> sOut<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>rb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>TEMP_FILENAME<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        METHOD_FLAG <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> METHOD_DEFLATE <span style='color:#0000ff; '>?</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Encode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Decode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ReadFileContents<span style='color:#0000ff; '>(</span>TEMP_FILENAME<span style='color:#0000ff; '>,</span> sOut<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>remove</span><span style='color:#0000ff; '>(</span>TEMP_FILENAME<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Compress_From_Data_To_File<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>int</span> METHOD_FLAG<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sIn<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sOut<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>TEMP_FILENAME<span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb+</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sOut<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>fwrite</span><span style='color:#0000ff; '>(</span>sIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>,</span> sIn<span style='color:#0000ff; '>.</span>length<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fseek</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>,</span> SEEK_SET<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        METHOD_FLAG <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> METHOD_DEFLATE <span style='color:#0000ff; '>?</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Encode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Decode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>remove</span><span style='color:#0000ff; '>(</span>TEMP_FILENAME<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> LZARI_Compress<span style='color:#0000ff; '>::</span>Compress_From_Data_To_Data<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> <span style='color:#0000ff; font-weight:bold; '>int</span> METHOD_FLAG<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sIn<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>&amp;</span> sOut<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ClearAll<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sTempIn  <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>)</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>_I_</span><span style='color:#0000e6; '>"</span> <span style='color:#0000ff; '>+</span> TEMP_FILENAME<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>const</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span> sTempOut <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>(</span>std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>)</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>_O_</span><span style='color:#0000e6; '>"</span> <span style='color:#0000ff; '>+</span> TEMP_FILENAME<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sTempIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb+</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile    <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>fopen</span><span style='color:#0000ff; '>(</span>sTempOut<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>wb+</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile <span style='color:#0000ff; '>&amp;</span><span style='color:#0000ff; '>&amp;</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>fwrite</span><span style='color:#0000ff; '>(</span>sIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>,</span> sIn<span style='color:#0000ff; '>.</span>length<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fseek</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>,</span> SEEK_SET<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        METHOD_FLAG <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> METHOD_DEFLATE <span style='color:#0000ff; '>?</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Encode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>:</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>Decode<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>infile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>fclose</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>outfile<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

        <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ReadFileContents<span style='color:#0000ff; '>(</span>sTempOut<span style='color:#0000ff; '>,</span> sOut<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>{</span>
            <span style='color:#0000ff; font-weight:bold; '>remove</span><span style='color:#0000ff; '>(</span>sTempIn<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
            <span style='color:#0000ff; font-weight:bold; '>remove</span><span style='color:#0000ff; '>(</span>sTempOut<span style='color:#0000ff; '>.</span>c_str<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

            <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>
</pre>