<pre style='color:#000000;background:#ffffff;'><span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Author:  Yee Hsu</span>
<span style='color:#008000; '>// Date:    9/5/2008</span>
<span style='color:#008000; '>// File:    </span><span style='color:#5555dd; '>FTP.cpp</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Desc:    FTP wrapper that does simple FTP API calls. Now we have an FTP</span>
<span style='color:#008000; '>//          object we can call and use to make FTP connections, transfer</span>
<span style='color:#008000; '>//          files, and download files using this simple API</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>stdafx.h</span><span style='color:#0000e6; '>"</span>
<span style='color:#004a43; '>#</span><span style='color:#004a43; '>include </span><span style='color:#0000e6; '>"</span><span style='color:#40015a; '>CFTP.h</span><span style='color:#0000e6; '>"</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  CFTP()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: CFTP Constructor</span>
<span style='color:#008000; '>// ==========================================================================</span>

CFTP<span style='color:#0000ff; '>::</span>CFTP<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents         <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hInternet             <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hConnection           <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hFileHandle           <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize            <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadId            <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadExitCode      <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>0</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>lpThreadIdleMSec      <span style='color:#0000ff; '>=</span> <span style='color:#800000; '>60000</span><span style='color:#800000; '>L</span><span style='color:#0000ff; '>;</span>   <span style='color:#008000; '>// Default Timeout: 1 minute</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bFTPSuccess           <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  CFTP()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: CFTP Destructor</span>
<span style='color:#008000; '>// ==========================================================================</span>

CFTP<span style='color:#0000ff; '>::</span><span style='color:#0000ff; '>~</span>CFTP<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents         <span style='color:#0000ff; '>=</span> <span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hInternet             <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hConnection           <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>hFileHandle           <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize            <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  InitFTPInfo()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Initialize FTP info</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>void</span> CFTP<span style='color:#0000ff; '>::</span>InitFTPInfo<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ftpInfo <span style='color:#0000ff; '>=</span> ftpInfo<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  InternetOpen()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Open an FTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    hInternet <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000e6; '>"</span><span style='color:#0000e6; '>FTP Connection</span><span style='color:#0000e6; '>"</span><span style='color:#0000ff; '>,</span> INTERNET_OPEN_TYPE_DIRECT<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span>hInternet <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  InternetClose()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Close an FTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> hFileHandle <span style='color:#0000ff; '>)</span>
        InternetCloseHandle<span style='color:#0000ff; '>(</span> hFileHandle <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> hConnection <span style='color:#0000ff; '>)</span>
        InternetCloseHandle<span style='color:#0000ff; '>(</span> hConnection <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> hInternet <span style='color:#0000ff; '>)</span>
        InternetCloseHandle<span style='color:#0000ff; '>(</span> hInternet <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpConnect()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Connection to an FTP session</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    hConnection <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>InternetConnect<span style='color:#0000ff; '>(</span>hInternet<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszServerName<span style='color:#0000ff; '>,</span> INTERNET_DEFAULT_FTP_PORT<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszUserName<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszPassword<span style='color:#0000ff; '>,</span> INTERNET_SERVICE_FTP<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span>hConnection <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpSetCurrentDirectory()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Sets the current directory for an FTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span> hConnection<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszDirectory<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpFindFirstFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Finds the first file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpFindFirstFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>WIN32_FIND_DATA</span> lpFindFileDate <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>{</span><span style='color:#800000; '>0</span><span style='color:#0000ff; '>}</span><span style='color:#0000ff; '>;</span>

    hFileHandle <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>FtpFindFirstFile<span style='color:#0000ff; '>(</span>hConnection<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszRemoteFile<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>lpFindFileDate<span style='color:#0000ff; '>,</span> INTERNET_FLAG_RELOAD<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span>hFileHandle <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>FileTimeToSystemTime</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>&amp;</span>lpFindFileDate<span style='color:#0000ff; '>.</span>ftLastWriteTime<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>stSysTime <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span> 
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpOpenFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Opens the file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpOpenFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    hFileHandle <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>FtpOpenFile<span style='color:#0000ff; '>(</span> hConnection<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszRemoteFile<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>GENERIC_READ</span><span style='color:#0000ff; '>,</span> FTP_TRANSFER_TYPE_BINARY <span style='color:#0000ff; '>|</span> INTERNET_FLAG_RELOAD<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span> <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span>hFileHandle <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>    
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpReadFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Reads the file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpReadFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>bool</span>  bRet<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwFileSizeHigh<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>char</span><span style='color:#0000ff; '>*</span> szBuffer <span style='color:#0000ff; '>=</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>;</span>
    szBuffer <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>new</span> <span style='color:#0000ff; font-weight:bold; '>char</span><span style='color:#0000ff; '>[</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>]</span><span style='color:#0000ff; '>;</span>      <span style='color:#008000; '>// Extra character reserved for terminating NULL character</span>
    <span style='color:#0000ff; font-weight:bold; '>memset</span><span style='color:#0000ff; '>(</span>szBuffer<span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize <span style='color:#0000ff; '>+</span> <span style='color:#800000; '>1</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>      <span style='color:#008000; '>// init the array with \0</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents<span style='color:#0000ff; '>.</span>clear<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> InternetReadFile<span style='color:#0000ff; '>(</span> hFileHandle<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; font-weight:bold; '>LPVOID</span> <span style='color:#0000ff; '>)</span> szBuffer<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwFileSizeHigh <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> FALSE <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        bRet <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents <span style='color:#0000ff; '>=</span> szBuffer<span style='color:#0000ff; '>;</span>
        bRet <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>szBuffer<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>delete</span> szBuffer<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> bRet<span style='color:#0000ff; '>;</span>    
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpGetFileSize()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets the file size</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpGetFileSize<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>DWORD</span> dwFileSizeHigh<span style='color:#0000ff; '>;</span>
    dwFileSize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>FtpGetFileSize<span style='color:#0000ff; '>(</span> hFileHandle<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>dwFileSizeHigh <span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpPutFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Uploads a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpPutFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>FtpPutFile<span style='color:#0000ff; '>(</span> hConnection<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszLocalFile<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszRemoteFile<span style='color:#0000ff; '>,</span> FTP_TRANSFER_TYPE_BINARY<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>    
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  FtpGetFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Downloads a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>FtpGetFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>if</span><span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span><span style='color:#0000ff; '>::</span>FtpGetFile<span style='color:#0000ff; '>(</span> hConnection<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszRemoteFile<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszLocalFile<span style='color:#0000ff; '>,</span> FALSE<span style='color:#0000ff; '>,</span> FILE_ATTRIBUTE_NORMAL<span style='color:#0000ff; '>,</span> FTP_TRANSFER_TYPE_BINARY<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span> <span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>    
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  UploadFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Uploads a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>UploadFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpPutFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  DownloadFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Downloads a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>DownloadFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpGetFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  DownloadFile()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets a file size</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>GetFileSize</span><span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>int</span><span style='color:#0000ff; '>&amp;</span> nFileSize<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpOpenFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpGetFileSize<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    nFileSize <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetFileDate()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets a file date</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>GetFileDate<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>SYSTEMTIME</span><span style='color:#0000ff; '>&amp;</span> stSysTime<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpFindFirstFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    
    stSysTime <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>stSysTime<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ReadFileContents()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Reads the contents of a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>ReadFileContents<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>&amp;</span> sFileContents<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpOpenFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpGetFileSize<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpReadFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    sFileContents <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents<span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  GetFileInfo()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Gets information about a file</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>GetFileInfo<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>const</span> FTPInfo ftpInfo<span style='color:#0000ff; '>,</span> std<span style='color:#0000ff; '>::</span><span style='color:#0000ff; font-weight:bold; '>string</span><span style='color:#0000ff; '>&amp;</span> sFileContents<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>SYSTEMTIME</span><span style='color:#0000ff; '>&amp;</span> stSysTime<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>int</span><span style='color:#0000ff; '>*</span> nFileSize<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InitFTPInfo<span style='color:#0000ff; '>(</span>ftpInfo<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetOpen<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpSetCurrentDirectory<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpFindFirstFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>   

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpOpenFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpGetFileSize<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>!</span><span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>FtpReadFile<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span>nFileSize<span style='color:#0000ff; '>)</span>
        <span style='color:#0000ff; '>*</span>nFileSize  <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>dwFileSize<span style='color:#0000ff; '>;</span>

    stSysTime       <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>stSysTime<span style='color:#0000ff; '>;</span>
    sFileContents   <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>sFileContents<span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>/* ***************************************  Threaded FTP Codes Here ****************************************** */</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  InternetConnect()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Makes an FTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> CFTP<span style='color:#0000ff; '>::</span>InternetConnect<span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>void</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bFTPSuccess <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>HANDLE</span> hThread <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>CreateThread</span><span style='color:#0000ff; '>(</span><span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>(</span><span style='color:#0000ff; font-weight:bold; '>LPTHREAD_START_ROUTINE</span><span style='color:#0000ff; '>)</span> ThreadStart<span style='color:#0000ff; '>,</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>,</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>,</span> <span style='color:#0000ff; '>&amp;</span>lpThreadId<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    
    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; font-weight:bold; '>WaitForSingleObject</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>,</span> lpThreadIdleMSec <span style='color:#0000ff; '>*</span> FTP_TIMEOUT_MINUTES<span style='color:#0000ff; '>)</span> <span style='color:#0000ff; '>=</span><span style='color:#0000ff; '>=</span> WAIT_TIMEOUT<span style='color:#0000ff; '>)</span>
    <span style='color:#0000ff; '>{</span>
        <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>WaitForSingleObject</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>,</span> lpThreadIdleMSec<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
        <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bFTPSuccess <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; '>}</span>
    <span style='color:#0000ff; font-weight:bold; '>CloseHandle</span><span style='color:#0000ff; '>(</span>hThread<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bFTPSuccess<span style='color:#0000ff; '>;</span>  <span style='color:#008000; '>// returns TRUE (in mult-threaded code) when FTP request success</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ThreadFTPRequestTimeOut()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Threaded FTP connection</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>bool</span> <span style='color:#0000ff; font-weight:bold; '>WINAPI</span> CFTP<span style='color:#0000ff; '>::</span>ThreadFTPRequestTimeOut<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    bFTPSuccess <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>false</span><span style='color:#0000ff; '>;</span>  

    hConnection <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; '>::</span>InternetConnect<span style='color:#0000ff; '>(</span>hInternet<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszServerName<span style='color:#0000ff; '>,</span> INTERNET_DEFAULT_FTP_PORT<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszUserName<span style='color:#0000ff; '>,</span> ftpInfo<span style='color:#0000ff; '>.</span>lpszPassword<span style='color:#0000ff; '>,</span> INTERNET_SERVICE_FTP<span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>,</span> <span style='color:#808080; font-weight:bold; '>NULL</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>if</span> <span style='color:#0000ff; '>(</span> <span style='color:#0000ff; '>!</span>hConnection <span style='color:#0000ff; '>)</span>
        InternetClose<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>else</span>
        <span style='color:#0000ff; font-weight:bold; '>this</span><span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>bFTPSuccess <span style='color:#0000ff; '>=</span> <span style='color:#0000ff; font-weight:bold; '>true</span><span style='color:#0000ff; '>;</span>

    <span style='color:#0000ff; font-weight:bold; '>ExitThread</span><span style='color:#0000ff; '>(</span>lpThreadExitCode<span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> bFTPSuccess<span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>

<span style='color:#008000; '>// ==========================================================================</span>
<span style='color:#008000; '>// Identifier:  ThreadStart()</span>
<span style='color:#008000; '>//</span>
<span style='color:#008000; '>// Description: Starts a FTP connection in its own thread</span>
<span style='color:#008000; '>// ==========================================================================</span>

<span style='color:#0000ff; font-weight:bold; '>DWORD</span> CFTP<span style='color:#0000ff; '>::</span>ThreadStart<span style='color:#0000ff; '>(</span>CFTP<span style='color:#0000ff; '>*</span> pFTP<span style='color:#0000ff; '>)</span>
<span style='color:#0000ff; '>{</span>
    pFTP<span style='color:#0000ff; '>-</span><span style='color:#0000ff; '>></span>ThreadFTPRequestTimeOut<span style='color:#0000ff; '>(</span><span style='color:#0000ff; '>)</span><span style='color:#0000ff; '>;</span>
    <span style='color:#0000ff; font-weight:bold; '>return</span> <span style='color:#800000; '>0</span><span style='color:#0000ff; '>;</span>
<span style='color:#0000ff; '>}</span>
</pre>